
<!-- saved from url=(0051)https://translate.googleusercontent.com/translate_f -->
<html lang="en" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="google" content="notranslate">
<script>(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="./Table of contents_files/translate_c.js"></script><script>_intlStrings._originalText = "Original Russian text:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="ru|en";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="Current translation on %1$s by %2$s";_intlStrings._unknown="unknown";_intlStrings._suggestTranslation="Contribute a better translation"  ;_intlStrings._submit="Contribute";_intlStrings._suggestThanks="Thank you for contributing your translation suggestion to Google Translate.";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href="https://translate.googleusercontent.com/_0c1c1bede648463ed60e3bd2e67db919_W5.pdf" hreflang="ru" rel="alternate machine-translated-from"><link href="./Table of contents_files/css" rel="stylesheet" type="text/css"><!--<base href="" target="_top">--><base href="." target="_top">

<meta name="Creator" content="LaTeX with hyperref package">
<meta name="Producer" content="LuaTeX-0.95.0">
<meta name="CreationDate" content="D:20171219232140+03&#39;00&#39;">
<meta name="ModDate" content="D:20171219232140+03&#39;00&#39;">
<meta name="FullBanner" content="This is LuaTeX, Version 0.95.0 (TeX Live 2016/Debian)">
<title>Table of contents</title>
<link type="text/css" rel="stylesheet" charset="UTF-8" href="./Table of contents_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./Table of contents_files/main_ar.js"></script><script type="text/javascript" charset="UTF-8" src="./Table of contents_files/element_main.js"></script><link rel="stylesheet" type="text/css" href="./Table of contents_files/iw_sprite.css"></head><body bgcolor="#ffffff" vlink="blue" link="blue" data-new-gr-c-s-check-loaded="14.1014.0" data-gr-ext-installed="">
        <style>
          .spinner-container {
            width:25%;
            top:20px;
            left:50%;
            margin-left:-12.5%;
            border-radius:8px;
            position:fixed;
            text-align:center;
            box-shadow:0 0 10px rgba(0,0,0,0.24);
            background:#fff;
            overflow:hidden;
          }

          .spinner-container p{
            font-family:'Roboto', Arial, sans-serif;
            color:rgba(0,0,0,0.87);
            margin:12px 0 16px 0;
            padding:0;
            font-size:12px;
          }

          .spinner-container img{
            width:22px;
            height:22px;
            margin:16px 0 0;
            padding:0;
          }
        </style>
        <div class="spinner-container notranslate" id="gt-dt-spinner" style="display: none;">
         <img src="./Table of contents_files/progress_spinner_color_20dp@2x.gif">
         <p>Translating...</p>
        </div>
      <iframe src="./Table of contents_files/translate_un.html" width="0" height="0" frameborder="0" style="width:0px;height:0px;border:0px;display:none;"></iframe>
<table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="1"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 1</font></font></b></a></font></td></tr></tbody></table><font size="5" face="Times"><span style="font-size:35px;font-family:Times">
<div style="position:absolute;top:371;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Table of contents</font></font></b></nobr></div>
</span></font>
<font size="3" color="#ff0000" face="Times"><span style="font-size:15px;font-family:Times;color:#ff0000">
<div style="position:absolute;top:484;left:85"><nobr><b><a href="https://translate.googleusercontent.com/translate_f#2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 Multithreading and asynchronous programming</font></font></a></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:484;left:823"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b></nobr></div>
</span></font>
<font size="3" color="#ff0000" face="Times"><span style="font-size:15px;font-family:Times;color:#ff0000">
<div style="position:absolute;top:506;left:112"><nobr><a href="https://translate.googleusercontent.com/translate_f#2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Introduction </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:506;left:823"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
</span></font>
<font size="3" color="#ff0000" face="Times"><span style="font-size:15px;font-family:Times;color:#ff0000">
<div style="position:absolute;top:527;left:112"><nobr><a href="https://translate.googleusercontent.com/translate_f#2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 Processes and threads </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:527;left:823"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
</span></font>
<font size="3" color="#ff0000" face="Times"><span style="font-size:15px;font-family:Times;color:#ff0000">
<div style="position:absolute;top:549;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.1 Process and its characteristics </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:549;left:823"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
</span></font>
<font size="3" color="#ff0000" face="Times"><span style="font-size:15px;font-family:Times;color:#ff0000">
<div style="position:absolute;top:571;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.2 Creating processes </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">...</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:571;left:823"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">five</font></font></nobr></div>
</span></font>
<font size="3" color="#ff0000" face="Times"><span style="font-size:15px;font-family:Times;color:#ff0000">
<div style="position:absolute;top:592;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.3 Creation of streams </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">10</font></font></font></nobr></div>
<div style="position:absolute;top:614;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.4 Synchronization of streams </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">12</font></font></font></nobr></div>
<div style="position:absolute;top:636;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.5 Global interpreter lock </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">17</font></font></font></nobr></div>
<div style="position:absolute;top:657;left:112"><nobr><a href="https://translate.googleusercontent.com/translate_f#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Working with a network, sockets </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">nineteen</font></font></font></nobr></div>
<div style="position:absolute;top:679;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.1 Sockets, client-server </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">nineteen</font></font></font></nobr></div>
<div style="position:absolute;top:701;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#22"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.2 Timeouts and Network Error Handling </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">22</font></font></font></nobr></div>
<div style="position:absolute;top:722;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.3 Handling multiple connections </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">24</font></font></font></nobr></div>
<div style="position:absolute;top:744;left:112"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4 Asynchronous programming </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">27</font></font></font></nobr></div>
<div style="position:absolute;top:766;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#27"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.1 Execution of code in one thread, select module </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">27</font></font></font></nobr></div>
<div style="position:absolute;top:787;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.2 Iterators and generators, what's the difference </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">29</font></font></font></nobr></div>
<div style="position:absolute;top:809;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#31"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.3 Generators and coroutines </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">31</font></font></font></nobr></div>
<div style="position:absolute;top:831;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#35"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.4 First steps with asyncio </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">35</font></font></font></nobr></div>
<div style="position:absolute;top:852;left:153"><nobr><a href="https://translate.googleusercontent.com/translate_f#38"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.5 Working with asyncio </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">39</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:1310;left:454"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:1363;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="2"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 2</font></font></b></a></font></td></tr></tbody></table></div><font size="5" face="Times"><span style="font-size:35px;font-family:Times">
<div style="position:absolute;top:1559;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Week 5</font></font></b></nobr></div>
<div style="position:absolute;top:1634;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multithreaded and asynchronous</font></font></b></nobr></div>
<div style="position:absolute;top:1678;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programming</font></font></b></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:1779;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1. </font><font style="vertical-align: inherit;">Introduction</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:1830;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asynchronous and multithreaded programming is a complex topic for</font></font></nobr></div>
<div style="position:absolute;top:1852;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">studying. </font><font style="vertical-align: inherit;">Our tutorial will be broken down into three main parts. </font><font style="vertical-align: inherit;">In the first part, we are</font></font></nobr></div>
<div style="position:absolute;top:1874;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we look at the execution of "synchronous programs", and look at examples of their execution</font></font></nobr></div>
<div style="position:absolute;top:1895;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in processes and threads. </font><font style="vertical-align: inherit;">Next, we'll dive into how sockets work and look at</font></font></nobr></div>
<div style="position:absolute;top:1917;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">execution of various network requests. </font><font style="vertical-align: inherit;">In the final part of our training, we</font></font></nobr></div>
<div style="position:absolute;top:1939;left:85"><nobr><font style="vertical-align: inherit;"><font class="" style="vertical-align: inherit;">let's dive into how generators and coroutines are arranged in Python and consider the use of</font></font></nobr></div>
<div style="position:absolute;top:1960;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">measures for working with the asyncio framework. </font><font style="vertical-align: inherit;">The knowledge gained can be useful for</font></font></nobr></div>
<div style="position:absolute;top:1982;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you, even if you are not developing in Python. </font><font style="vertical-align: inherit;">After completing the training, you will be able to</font></font></nobr></div>
<div style="position:absolute;top:2004;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">see how easy and convenient it is to do in Python and, perhaps, compare with others</font></font></nobr></div>
<div style="position:absolute;top:2025;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programming languages.</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:2085;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2. </font><font style="vertical-align: inherit;">Processes and threads</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:2140;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.1. </font><font style="vertical-align: inherit;">Process and its characteristics</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2178;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A process is a program that runs in the computer's RAM. </font><font style="vertical-align: inherit;">Other-</font></font></nobr></div>
<div style="position:absolute;top:2200;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In short, a process is a set of instructions that are executed sequentially.</font></font></nobr></div>
<div style="position:absolute;top:2221;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each process that runs in the operating system has its own characteristics.</font></font></nobr></div>
<div style="position:absolute;top:2243;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ki. </font><font style="vertical-align: inherit;">One of the main characteristics is the process ID or PID. </font><font style="vertical-align: inherit;">Moreover,</font></font></nobr></div>
<div style="position:absolute;top:2265;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">each process takes up a certain amount of RAM, which it requests from</font></font></nobr></div>
<div style="position:absolute;top:2286;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systems. </font><font style="vertical-align: inherit;">The system returns the requested amount of memory to the process and allocates it.</font></font></nobr></div>
<div style="position:absolute;top:2308;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The process also has a stack - it is used to call functions and create a local</font></font></nobr></div>
<div style="position:absolute;top:2330;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variables for these functions. </font><font style="vertical-align: inherit;">Finally, each process has a list of open</font></font></nobr></div>
<div style="position:absolute;top:2351;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files, standard input and standard output.</font></font></nobr></div>
<div style="position:absolute;top:2395;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following examples, we will use a Linux class operating system and</font></font></nobr></div>
<div style="position:absolute;top:2416;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python 3.</font></font></nobr></div>
<div style="position:absolute;top:2498;left:454"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:2551;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="3"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 3</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:2588;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:2641;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's try to find out what processes are running in the operating system. </font><font style="vertical-align: inherit;">For</font></font></nobr></div>
<div style="position:absolute;top:2663;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for this we need a console and a top command - it displays a list of processes that</font></font></nobr></div>
<div style="position:absolute;top:2684;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rye are now functioning in the operating system. </font><font style="vertical-align: inherit;">In the form of columns in the table, we see</font></font></nobr></div>
<div style="position:absolute;top:2706;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process characteristics:</font></font></nobr></div>
<div style="position:absolute;top:3262;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The table contains the PID (process identifier), the user from which the</font></font></nobr></div>
<div style="position:absolute;top:3284;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the process is running (determines the rights that will be available to this process in the opera-</font></font></nobr></div>
<div style="position:absolute;top:3305;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system), the size of virtual and physical memory, etc. </font><font style="vertical-align: inherit;">As we can see, the</font></font></nobr></div>
<div style="position:absolute;top:3327;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there are a lot of processes in the operating system, and they all work at first glance</font></font></nobr></div>
<div style="position:absolute;top:3349;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parallel. </font><font style="vertical-align: inherit;">In fact, this is not the case. </font><font style="vertical-align: inherit;">The operating system scheduler allocates</font></font></nobr></div>
<div style="position:absolute;top:3370;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a small slice of time for each process, executes it and then switches</font></font></nobr></div>
<div style="position:absolute;top:3392;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reading between processes. </font><font style="vertical-align: inherit;">Thus, the processes are executed sequentially, but</font></font></nobr></div>
<div style="position:absolute;top:3414;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">due to the fact that the time quantum is small, it seems to us that they are all performed in parallel</font></font></nobr></div>
<div style="position:absolute;top:3435;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicely.</font></font></nobr></div>
<div style="position:absolute;top:3479;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's try to start our first Python process and examine its characteristics-</font></font></nobr></div>
<div style="position:absolute;top:3500;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ki by means of the operating system. </font><font style="vertical-align: inherit;">First, we import two modules - time and os.</font></font></nobr></div>
<div style="position:absolute;top:3522;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then, by calling the function of the os.getpid module, we get the identifier of the</font></font></nobr></div>
<div style="position:absolute;top:3544;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process, store it in the pid variable and display the PID of our</font></font></nobr></div>
<div style="position:absolute;top:3565;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process and system time every 2 seconds:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:3683;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:3739;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="4"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 4</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:3776;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:3829;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># simple Python process</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:3872;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time</font></font></font></nobr></div>
<div style="position:absolute;top:3894;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:3937;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pid = os.getpid ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:3980;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
<div style="position:absolute;top:4002;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pid, time.time ())</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:4024;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time.sleep (2)</font></font></nobr></div>
<div style="position:absolute;top:4063;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python ex1.py</font></font></nobr></div>
<div style="position:absolute;top:4084;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2321 1488521934.518766</font></font></nobr></div>
<div style="position:absolute;top:4106;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2321 1488521936.520758</font></font></nobr></div>
<div style="position:absolute;top:4128;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2321 1488521938.522762</font></font></nobr></div>
<div style="position:absolute;top:4149;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b></nobr></div>
<div style="position:absolute;top:4185;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see that the process has started. </font><font style="vertical-align: inherit;">He outputted pid 2321, system time and</font></font></nobr></div>
<div style="position:absolute;top:4206;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It does this endlessly in a loop. </font><font style="vertical-align: inherit;">Let's try to find our process in the list of all</font></font></nobr></div>
<div style="position:absolute;top:4228;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processes. </font><font style="vertical-align: inherit;">To do this, the ps command with the aux flags will help us (detailed information</font></font></nobr></div>
<div style="position:absolute;top:4250;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">about flags can be found in the documentation). </font><font style="vertical-align: inherit;">This command will display a list of all processes</font></font></nobr></div>
<div style="position:absolute;top:4271;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">owls. </font><font style="vertical-align: inherit;">In order to find specifically our process, you can filter the output of ps aux</font></font></nobr></div>
<div style="position:absolute;top:4293;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the grep command. </font><font style="vertical-align: inherit;">We will see our process (in this case in the first line):</font></font></nobr></div>
<div style="position:absolute;top:4464;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To see the name of the characteristics, you can display the first line from the result</font></font></nobr></div>
<div style="position:absolute;top:4486;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tat the output of ps with the following command:</font></font></nobr></div>
<div style="position:absolute;top:4677;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, the process with PID 2321 is visible in the output of the ps command. </font><font style="vertical-align: inherit;">He consumes</font></font></nobr></div>
<div style="position:absolute;top:4699;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">little CPU and takes up 6 kilobytes of physical memory. </font><font style="vertical-align: inherit;">Also v-</font></font></nobr></div>
<div style="position:absolute;top:4721;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dim the command line with which it was launched (python3 ex1.py).</font></font></nobr></div>
<div style="position:absolute;top:4764;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What sequence of commands does our process execute? </font><font style="vertical-align: inherit;">In general, when processes</font></font></nobr></div>
<div style="position:absolute;top:4786;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are executed in the operating system, they make system calls. </font><font style="vertical-align: inherit;">System calls</font></font></nobr></div>
<div style="position:absolute;top:4807;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you execute directly the kernel of the operating system, and the results of these systems are</font></font></nobr></div>
<div style="position:absolute;top:4829;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calls return to the process that called them. </font><font style="vertical-align: inherit;">For example, output to the console,</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:4871;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">four</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:4927;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="5"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 5</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:4964;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:5017;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or standard output is a system call. </font><font style="vertical-align: inherit;">To see which system you-</font></font></nobr></div>
<div style="position:absolute;top:5039;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calls are made by our process, you can use the strace command by specifying the PID for</font></font></nobr></div>
<div style="position:absolute;top:5060;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your process (this command requires additional rights):</font></font></nobr></div>
<div style="position:absolute;top:5399;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, we see that the write system call is called. </font><font style="vertical-align: inherit;">He has in his arguments</font></font></nobr></div>
<div style="position:absolute;top:5421;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file descriptor 1 is standard output. </font><font style="vertical-align: inherit;">We also see that the standard output is</font></font></nobr></div>
<div style="position:absolute;top:5443;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the PID of our process and the system time drops, and other ones are used to call sleep</font></font></nobr></div>
<div style="position:absolute;top:5464;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">additional system calls. </font><font style="vertical-align: inherit;">To exit, use Ctrl + C.</font></font></nobr></div>
<div style="position:absolute;top:5508;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, we learned that the process communicates with the operating system at runtime.</font></font></nobr></div>
<div style="position:absolute;top:5529;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using system calls. </font><font style="vertical-align: inherit;">Let's take a look at the list of files that are open</font></font></nobr></div>
<div style="position:absolute;top:5551;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in our process. </font><font style="vertical-align: inherit;">To do this, you can use the lsof command, specifying the PID of the process</font></font></nobr></div>
<div style="position:absolute;top:5573;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca (lsof -p 2321). </font><font style="vertical-align: inherit;">We will see that the process uses many Python libraries. </font><font style="vertical-align: inherit;">But</font></font></nobr></div>
<div style="position:absolute;top:5594;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the most important thing that interests us now is the standard input, output, and</font></font></nobr></div>
<div style="position:absolute;top:5616;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">error current (file descriptors 0, 1 and 2):</font></font></nobr></div>
<div style="position:absolute;top:5748;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can see that these file descriptors are equal to the terminal. </font><font style="vertical-align: inherit;">If we do</font></font></nobr></div>
<div style="position:absolute;top:5769;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standard output to a file (using the python3 exq.py&gt; log.txt command), we</font></font></nobr></div>
<div style="position:absolute;top:5791;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see that the standard output of our process has changed to a file:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:5957;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.2. </font><font style="vertical-align: inherit;">Process creation</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:5995;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's talk about creating processes in Python. </font><font style="vertical-align: inherit;">In this section, we will learn how to create a pre-</font></font></nobr></div>
<div style="position:absolute;top:6017;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">black process, how the fork system call works, and also consider examples of co-</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:6059;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">five</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:6115;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="6"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 6</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:6152;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:6205;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">building processes using the multiprocessing module.</font></font></nobr></div>
<div style="position:absolute;top:6248;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A process in the operating system is created using the fork system call. </font><font style="vertical-align: inherit;">Yes-</font></font></nobr></div>
<div style="position:absolute;top:6270;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consider a program that creates a child process using the system</font></font></nobr></div>
<div style="position:absolute;top:6292;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call fork. </font><font style="vertical-align: inherit;">Import a couple of time and os modules, then call the system call</font></font></nobr></div>
<div style="position:absolute;top:6314;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fork:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:6354;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Create a process in Python</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:6398;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time</font></font></font></nobr></div>
<div style="position:absolute;top:6419;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:6463;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pid = os.fork ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:6484;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pid == 0:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:6506;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># child process</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:6528;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
<div style="position:absolute;top:6549;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"child:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, os.getpid ())</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:6571;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time.sleep (5)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:6593;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:6614;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># parent process</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:6636;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"parent:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, os.getpid ())</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:6658;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.wait ()</font></font></nobr></div>
<div style="position:absolute;top:6694;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parent: 2411</font></font></nobr></div>
<div style="position:absolute;top:6716;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">child: 2412</font></font></nobr></div>
<div style="position:absolute;top:6749;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The fork system call creates an exact copy of the parent process. </font><font style="vertical-align: inherit;">It means,</font></font></nobr></div>
<div style="position:absolute;top:6770;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that all memory, all file descriptors and all resources that were available in the parent</font></font></nobr></div>
<div style="position:absolute;top:6792;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tel process, will be completely and completely copied to the child process. </font><font style="vertical-align: inherit;">Since then</font></font></nobr></div>
<div style="position:absolute;top:6814;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the moment the fork system call is executed, we have two identical processes</font></font></nobr></div>
<div style="position:absolute;top:6835;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the operating system. </font><font style="vertical-align: inherit;">The only difference is that the system</font></font></nobr></div>
<div style="position:absolute;top:6857;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calling fork to the parent process will return the PID of the child process, and in the child process</font></font></nobr></div>
<div style="position:absolute;top:6879;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the pid variable will be zero. </font><font style="vertical-align: inherit;">The code in the if block will be executed in the child process</font></font></nobr></div>
<div style="position:absolute;top:6900;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">everything, and the code behind the else branch will be executed in the parent process.</font></font></nobr></div>
<div style="position:absolute;top:6922;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also in the parent process we call the os.wait system call, this is another</font></font></nobr></div>
<div style="position:absolute;top:6944;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an additional system call and it allows us to wait for the completion of the created</font></font></nobr></div>
<div style="position:absolute;top:6965;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th child process. </font><font style="vertical-align: inherit;">And in the child process in an infinite loop, the PID of this</font></font></nobr></div>
<div style="position:absolute;top:6987;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process every five seconds.</font></font></nobr></div>
<div style="position:absolute;top:7030;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can display the results of the ps command hierarchically to see if</font></font></nobr></div>
<div style="position:absolute;top:7052;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which of the processes is the parent and which is the child. </font><font style="vertical-align: inherit;">This is done with the help of an additional</font></font></nobr></div>
<div style="position:absolute;top:7074;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:7247;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:7303;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="7"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 7</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:7340;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:7393;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we call the strace command, we can see that our created child process is de-</font></font></nobr></div>
<div style="position:absolute;top:7415;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">barks the write system call and writes information to standard output. </font><font style="vertical-align: inherit;">A ro-</font></font></nobr></div>
<div style="position:absolute;top:7436;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the parent process made the wait system call, and the operating system itself notifies</font></font></nobr></div>
<div style="position:absolute;top:7458;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tells it when the child process exits.</font></font></nobr></div>
<div style="position:absolute;top:7501;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take another look at memory in parent and child processes and distribution</font></font></nobr></div>
<div style="position:absolute;top:7523;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">see an example. </font><font style="vertical-align: inherit;">So, we have a program, we declared the variable foo in it, with-</font></font></nobr></div>
<div style="position:absolute;top:7545;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set it to "bar" and make the fork system call:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:7585;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Memory of parent and child process</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:7629;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:7672;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo = </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"bar"</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:7715;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.fork () == 0:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:7737;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># child process</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:7759;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo = </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"baz"</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:7780;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"child:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, foo)</font></font></font></nobr></div>
<div style="position:absolute;top:7802;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:7824;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># parent process</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:7845;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"parent:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, foo)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:7867;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.wait ()</font></font></nobr></div>
<div style="position:absolute;top:7898;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the fork system call has run, as already mentioned, all memory is</font></font></nobr></div>
<div style="position:absolute;top:7920;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be copied entirely from the parent process to the child process. </font><font style="vertical-align: inherit;">Means,</font></font></nobr></div>
<div style="position:absolute;top:7941;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the variable foo will be available in the child process with the value "bar". </font><font style="vertical-align: inherit;">But if we</font></font></nobr></div>
<div style="position:absolute;top:7963;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">change the value of foo in the child process, this will not affect the variable foo in any way,</font></font></nobr></div>
<div style="position:absolute;top:7985;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which was declared in the parent process:</font></font></nobr></div>
<div style="position:absolute;top:8048;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parent: bar</font></font></nobr></div>
<div style="position:absolute;top:8070;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">child: baz</font></font></nobr></div>
<div style="position:absolute;top:8110;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, we learned that the memory in the child process is copied, and that the child and parent are</font></font></nobr></div>
<div style="position:absolute;top:8132;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telly processes use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">different memory</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></nobr></div>
<div style="position:absolute;top:8175;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The same applies to file descriptors. </font><font style="vertical-align: inherit;">Suppose we have a small</font></font></nobr></div>
<div style="position:absolute;top:8197;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your file with two lines: example string1 and example string2. </font><font style="vertical-align: inherit;">Opening the file</font></font></nobr></div>
<div style="position:absolute;top:8219;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to read and read one line into the foo variable. </font><font style="vertical-align: inherit;">After we counted one</font></font></nobr></div>
<div style="position:absolute;top:8240;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line, we make the fork system call. </font><font style="vertical-align: inherit;">After that, we create an exact copy of the parentage</font></font></nobr></div>
<div style="position:absolute;top:8262;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tel process:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:8435;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:8491;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="8"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 8</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:8528;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:8581;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Files in parent and child process</font></font></nobr></div>
<div style="position:absolute;top:8624;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cat data.txt</font></font></nobr></div>
<div style="position:absolute;top:8646;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># example string1</font></font></nobr></div>
<div style="position:absolute;top:8668;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># example string2</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:8711;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:8754;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f = open ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"data.txt"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:8776;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo = f.readline ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:8819;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.fork () == 0:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:8841;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># child process</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:8863;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo = f.readline ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:8884;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"child:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, foo)</font></font></font></nobr></div>
<div style="position:absolute;top:8906;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:8928;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># parent process</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:8949;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo = f.readline ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:8971;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"parent:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, foo)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:9002;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we in the child process again call the readline () method on the object f, then we</font></font></nobr></div>
<div style="position:absolute;top:9024;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let's read the second line from this file. </font><font style="vertical-align: inherit;">But this will not affect the parent in any way.</font></font></nobr></div>
<div style="position:absolute;top:9045;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process. </font><font style="vertical-align: inherit;">In the parent process, if we call readline (), then we are exactly the same</font></font></nobr></div>
<div style="position:absolute;top:9067;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we count the second line:</font></font></nobr></div>
<div style="position:absolute;top:9130;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parent: example string2</font></font></nobr></div>
<div style="position:absolute;top:9152;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">child: example string2</font></font></nobr></div>
<div style="position:absolute;top:9193;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, once again we draw your attention to the fact that not only memory, but also file disk</font></font></nobr></div>
<div style="position:absolute;top:9214;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ry is completely and completely copied in the child process when we make the system</font></font></nobr></div>
<div style="position:absolute;top:9236;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call fork.</font></font></nobr></div>
<div style="position:absolute;top:9279;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All of these examples are educational in nature, and usually code using systems-</font></font></nobr></div>
<div style="position:absolute;top:9301;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fork calls are a little more complicated. </font><font style="vertical-align: inherit;">fork may return an error that needs to be checked</font></font></nobr></div>
<div style="position:absolute;top:9323;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that's why usually in Python they use the module to create processes</font></font></nobr></div>
<div style="position:absolute;top:9345;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing. </font><font style="vertical-align: inherit;">In order to start the process in this way, you need to</font></font></nobr></div>
<div style="position:absolute;top:9366;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port the Process class from the multiprocessing module, create an object of the Process class,</font></font></nobr></div>
<div style="position:absolute;top:9388;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pass it to the constructor the function that we want to execute in a separate child</font></font></nobr></div>
<div style="position:absolute;top:9409;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the process and the arguments to this function. </font><font style="vertical-align: inherit;">The process will be created when we call</font></font></nobr></div>
<div style="position:absolute;top:9431;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the start method of our object. </font><font style="vertical-align: inherit;">Inside the start method, the fork system call will be called</font></font></nobr></div>
<div style="position:absolute;top:9453;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and our function f is executed in a separate process. </font><font style="vertical-align: inherit;">It is very important to wait for completion</font></font></nobr></div>
<div style="position:absolute;top:9474;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all created child processes. </font><font style="vertical-align: inherit;">To do this, you can use the convenient function</font></font></nobr></div>
<div style="position:absolute;top:9496;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">her join:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:9623;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eight</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:9679;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="9"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 9</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:9716;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:9769;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Creating a process, module multiprocessing</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:9812;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process</font></font></font></nobr></div>
<div style="position:absolute;top:9855;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f (name):</font></font></font></nobr></div>
<div style="position:absolute;top:9877;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, name)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:9920;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p = Process (target = f, args = ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bob"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,))</font></font></nobr></div>
<div style="position:absolute;top:9942;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p.start ()</font></font></nobr></div>
<div style="position:absolute;top:9964;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p.join ()</font></font></nobr></div>
<div style="position:absolute;top:10008;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello bob</font></font></nobr></div>
<div style="position:absolute;top:10049;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we can see, the fork and wait system calls are hidden inside beautiful wrappers.</font></font></nobr></div>
<div style="position:absolute;top:10071;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, not every operating system has a fork system call, and therefore</font></font></nobr></div>
<div style="position:absolute;top:10093;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing is neatly done for you.</font></font></nobr></div>
<div style="position:absolute;top:10136;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is also an alternative method for creating a process using</font></font></nobr></div>
<div style="position:absolute;top:10158;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing - using the inheritance mechanism. </font><font style="vertical-align: inherit;">To do this, we declare our</font></font></nobr></div>
<div style="position:absolute;top:10179;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class, inherited from the Process class. </font><font style="vertical-align: inherit;">We pass the required parameters to the constructor for</font></font></nobr></div>
<div style="position:absolute;top:10201;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the function that should be run in the child process and override the method</font></font></nobr></div>
<div style="position:absolute;top:10222;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run. </font><font style="vertical-align: inherit;">In the run method, we implement the code that the child process should execute. </font><font style="vertical-align: inherit;">Yes-</font></font></nobr></div>
<div style="position:absolute;top:10244;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">further, we create an object of our PrintProcess class, pass the parameters there, call</font></font></nobr></div>
<div style="position:absolute;top:10266;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start method. </font><font style="vertical-align: inherit;">The start method will call fork and execute our code in the child process. </font><font style="vertical-align: inherit;">For</font></font></nobr></div>
<div style="position:absolute;top:10287;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when the child process ends, we call the join method:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:10328;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Creating a process, module multiprocessing</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:10371;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process</font></font></font></nobr></div>
<div style="position:absolute;top:10415;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><font color="#2b91b0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrintProcess </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Process):</font></font></font></nobr></div>
<div style="position:absolute;top:10436;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init __ (self, name):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:10458;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">super () .__ init __ ()</font></font></nobr></div>
<div style="position:absolute;top:10480;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.name = name</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:10523;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run (self):</font></font></font></nobr></div>
<div style="position:absolute;top:10545;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, self.name)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:10588;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p = PrintProcess ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mike"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:10610;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p.start ()</font></font></nobr></div>
<div style="position:absolute;top:10631;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p.join ()</font></font></nobr></div>
<div style="position:absolute;top:10676;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello mike</font></font></nobr></div>
<div style="position:absolute;top:10717;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is very important to wait for all child processes to finish in order to control</font></font></nobr></div>
<div style="position:absolute;top:10738;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">release of all resources.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:10811;left:821"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nine</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:10867;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="10"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 10</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:10904;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:10955;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.3. </font><font style="vertical-align: inherit;">Creating streams</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:10994;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this section, we'll talk about streams. </font><font style="vertical-align: inherit;">We will discuss creating streams using mod-</font></font></nobr></div>
<div style="position:absolute;top:11015;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for threading and using the ThreadPoolExecutor class. </font><font style="vertical-align: inherit;">From an applied point of view</font></font></nobr></div>
<div style="position:absolute;top:11037;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The flow completely and completely resembles the process. </font><font style="vertical-align: inherit;">It has its own sequence</font></font></nobr></div>
<div style="position:absolute;top:11059;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions for execution, each thread has its own stack, but all threads</font></font></nobr></div>
<div style="position:absolute;top:11080;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are performed within the same process. </font><font style="vertical-align: inherit;">This is how they differ from processes. </font><font style="vertical-align: inherit;">If, when</font></font></nobr></div>
<div style="position:absolute;top:11102;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we talked about processes, each process had its own resources and memory, then everything was created</font></font></nobr></div>
<div style="position:absolute;top:11124;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads share the memory of a process and all of its resources. </font><font style="vertical-align: inherit;">Management and execution</font></font></nobr></div>
<div style="position:absolute;top:11145;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threads are handled by the operating system. </font><font style="vertical-align: inherit;">But Python has its limitations for threading.</font></font></nobr></div>
<div style="position:absolute;top:11167;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kov - we will discuss them separately.</font></font></nobr></div>
<div style="position:absolute;top:11210;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So let's take a look at an example of creating a thread in Python. </font><font style="vertical-align: inherit;">Everything will be very similar</font></font></nobr></div>
<div style="position:absolute;top:11232;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the same for creating processes. </font><font style="vertical-align: inherit;">First, we use the threading module and import from</font></font></nobr></div>
<div style="position:absolute;top:11254;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">its a Thread class. </font><font style="vertical-align: inherit;">Next, we declare the function that we want to execute in a separate</font></font></nobr></div>
<div style="position:absolute;top:11275;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thread and create an object of the Thread class, passing our function f and arguments into it, with</font></font></nobr></div>
<div style="position:absolute;top:11297;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by which this function should be called. </font><font style="vertical-align: inherit;">After we have created the object, no</font></font></nobr></div>
<div style="position:absolute;top:11319;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the thread will not be started - it will be started when we call the start method on this</font></font></nobr></div>
<div style="position:absolute;top:11340;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">object. </font><font style="vertical-align: inherit;">It is also very important to wait for the completion of all created threads.</font></font></nobr></div>
<div style="position:absolute;top:11362;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cov using the join method:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:11403;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Create a stream</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:11446;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thread</font></font></font></nobr></div>
<div style="position:absolute;top:11489;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f (name):</font></font></font></nobr></div>
<div style="position:absolute;top:11511;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, name)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:11554;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th = Thread (target = f, args = ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bob"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,))</font></font></nobr></div>
<div style="position:absolute;top:11576;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th.start ()</font></font></nobr></div>
<div style="position:absolute;top:11598;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th.join ()</font></font></nobr></div>
<div style="position:absolute;top:11642;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello bob</font></font></nobr></div>
<div style="position:absolute;top:11683;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is also an alternative method for creating a stream using inheritance.</font></font></nobr></div>
<div style="position:absolute;top:11705;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Again, this is very similar to using the multiprocessing module. </font><font style="vertical-align: inherit;">We declare</font></font></nobr></div>
<div style="position:absolute;top:11726;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your class inherited from the Thread class and pass the necessary arguments to the constructor,</font></font></nobr></div>
<div style="position:absolute;top:11748;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to execute the function in a separate thread:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:11999;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:12055;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="11"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 11</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:12092;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:12145;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Create a stream</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:12188;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thread</font></font></font></nobr></div>
<div style="position:absolute;top:12231;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><font color="#2b91b0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrintThread </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Thread):</font></font></font></nobr></div>
<div style="position:absolute;top:12253;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init __ (self, name):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:12275;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">super () .__ init __ ()</font></font></nobr></div>
<div style="position:absolute;top:12296;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.name = name</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:12340;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run (self):</font></font></font></nobr></div>
<div style="position:absolute;top:12361;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, self.name)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:12405;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th = PrintThread ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mike"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:12426;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th.start ()</font></font></nobr></div>
<div style="position:absolute;top:12448;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th.join ()</font></font></nobr></div>
<div style="position:absolute;top:12492;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello mike</font></font></nobr></div>
<div style="position:absolute;top:12533;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python3 introduces a very convenient class for creating a thread pool -</font></font></nobr></div>
<div style="position:absolute;top:12555;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor from concurrent.futures module. </font><font style="vertical-align: inherit;">Suppose we have a certain</font></font></nobr></div>
<div style="position:absolute;top:12577;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an array of numbers, and we need to use a limited number of threads to calculate the quad</font></font></nobr></div>
<div style="position:absolute;top:12598;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rats of these numbers. </font><font style="vertical-align: inherit;">To do this, you can use the context manager, specify in it</font></font></nobr></div>
<div style="position:absolute;top:12620;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calling ThreadPoolExecutor with the max_workers parameter, which is just responsible for</font></font></nobr></div>
<div style="position:absolute;top:12642;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the maximum number of threads to be created in this with block. </font><font style="vertical-align: inherit;">Necessary</font></font></nobr></div>
<div style="position:absolute;top:12663;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the number of threads will be created automatically, and upon completion of the context menu</font></font></nobr></div>
<div style="position:absolute;top:12685;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jer, the shutdown function will be called, which will wait until all created</font></font></nobr></div>
<div style="position:absolute;top:12707;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">streams. </font><font style="vertical-align: inherit;">The main function of ThreadPoolExecutor is the submit method. </font><font style="vertical-align: inherit;">He creates</font></font></nobr></div>
<div style="position:absolute;top:12728;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class object</font></font></nobr></div>
<div style="position:absolute;top:12750;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concurrent.futures.Future is such an object that hasn't completed yet, but you-</font></font></nobr></div>
<div style="position:absolute;top:12772;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is being completed and will be completed in the future. </font><font style="vertical-align: inherit;">Using the convenience method as_completed from</font></font></nobr></div>
<div style="position:absolute;top:12793;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">module concurrent.futures we can wait for all objects to complete and get</font></font></nobr></div>
<div style="position:absolute;top:12815;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read the results as all the threads we created are finished:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:12856;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Thread pool, concurrent.futures.Future</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:12899;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concurrent.futures</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor, as_completed</font></font></font></nobr></div>
<div style="position:absolute;top:12942;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f (a):</font></font></font></nobr></div>
<div style="position:absolute;top:12964;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a * a</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:13007;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># .shutdown () in exit</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:13029;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThreadPoolExecutor (max_workers = 3)</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pool:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:13051;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">results = [pool.submit (f, i) </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> i </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> range (10)]</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:13094;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">future</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as_completed (results):</font></font></font></nobr></div>
<div style="position:absolute;top:13116;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(future.result ())</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:13187;left:811"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eleven</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:13243;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="12"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 12</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:13280;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:13333;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></nobr></div>
<div style="position:absolute;top:13355;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></nobr></div>
<div style="position:absolute;top:13377;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">four</font></font></nobr></div>
<div style="position:absolute;top:13398;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nine</font></font></nobr></div>
<div style="position:absolute;top:13420;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:13474;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.4. </font><font style="vertical-align: inherit;">Synchronizing streams</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:13513;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this video we will talk about thread synchronization and discuss queues, locks</font></font></nobr></div>
<div style="position:absolute;top:13534;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and conditional variables. </font><font style="vertical-align: inherit;">If you run multiple threads to solve your problem</font></font></nobr></div>
<div style="position:absolute;top:13556;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chi, then sooner or later you will have to exchange data between threads. </font><font style="vertical-align: inherit;">Often for</font></font></nobr></div>
<div style="position:absolute;top:13578;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thread synchronizations use locks. </font><font style="vertical-align: inherit;">But any blocking slows down the execution.</font></font></nobr></div>
<div style="position:absolute;top:13599;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">change of the program. </font><font style="vertical-align: inherit;">Better not to use blocking and give preference to exchange</font></font></nobr></div>
<div style="position:absolute;top:13621;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data through queues.</font></font></nobr></div>
<div style="position:absolute;top:13664;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's first figure out how you can use the queue module and queues to</font></font></nobr></div>
<div style="position:absolute;top:13686;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data exchange between threads. </font><font style="vertical-align: inherit;">Using queues looks pretty straightforward</font></font></nobr></div>
<div style="position:absolute;top:13708;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smoke. </font><font style="vertical-align: inherit;">In the following example, we create a queue object with a maximum size</font></font></nobr></div>
<div style="position:absolute;top:13729;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rum 5. To put items in the queue, use the put method of the object.</font></font></nobr></div>
<div style="position:absolute;top:13751;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that Queue. </font><font style="vertical-align: inherit;">Please note that if there are already five items in the queue, then</font></font></nobr></div>
<div style="position:absolute;top:13773;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calling the put method will block execution of the thread that called this method and will</font></font></nobr></div>
<div style="position:absolute;top:13794;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wait until there is free space in the queue. </font><font style="vertical-align: inherit;">So, to process messages this</font></font></nobr></div>
<div style="position:absolute;top:13816;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queue, we create a pair of threads - objects of class Thread. </font><font style="vertical-align: inherit;">We pass to this object</font></font></nobr></div>
<div style="position:absolute;top:13838;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the worker function to which we pass our queue. </font><font style="vertical-align: inherit;">So, the worker function will execute</font></font></nobr></div>
<div style="position:absolute;top:13859;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run in two independent parallel streams. </font><font style="vertical-align: inherit;">Every stream in an endless loop</font></font></nobr></div>
<div style="position:absolute;top:13881;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will get the message from the queue by calling the get method on the q object:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:14375;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:14431;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="13"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 13</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:14468;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:14521;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Queues, module queue</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:14542;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queue</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queue</font></font></font></nobr></div>
<div style="position:absolute;top:14564;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thread</font></font></font></nobr></div>
<div style="position:absolute;top:14607;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker (q, n):</font></font></font></nobr></div>
<div style="position:absolute;top:14629;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:14651;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item = q.get ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:14672;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None:</font></font></font></nobr></div>
<div style="position:absolute;top:14694;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:14716;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"process data:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n, item)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:14759;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">q = Queue (5)</font></font></nobr></div>
<div style="position:absolute;top:14781;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th1 = Thread (target = worker, args = (q, 1))</font></font></nobr></div>
<div style="position:absolute;top:14802;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th2 = Thread (target = worker, args = (q, 2))</font></font></nobr></div>
<div style="position:absolute;top:14824;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th1.start (); </font><font style="vertical-align: inherit;">th2.start ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:14867;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">range (50):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:14889;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">q.put (i)</font></font></nobr></div>
<div style="position:absolute;top:14932;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">q.put (None); </font><font style="vertical-align: inherit;">q.put (None)</font></font></nobr></div>
<div style="position:absolute;top:14954;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th1.join (); </font><font style="vertical-align: inherit;">th2.join ()</font></font></nobr></div>
<div style="position:absolute;top:14990;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process data: 1 0</font></font></nobr></div>
<div style="position:absolute;top:15012;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process data: 1 1</font></font></nobr></div>
<div style="position:absolute;top:15034;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process data: 2 3</font></font></nobr></div>
<div style="position:absolute;top:15055;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b></nobr></div>
<div style="position:absolute;top:15088;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Great care must be taken to properly terminate the flow. </font><font style="vertical-align: inherit;">Resources for</font></font></nobr></div>
<div style="position:absolute;top:15109;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the process, that is, the allocated memory or open file, is owned by the process itself. </font><font style="vertical-align: inherit;">But pro</font></font></nobr></div>
<div style="position:absolute;top:15131;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cess knows nothing about what the thread is doing with these resources. </font><font style="vertical-align: inherit;">And if the stream ends</font></font></nobr></div>
<div style="position:absolute;top:15153;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abnormally, the file may remain unclosed, the lock may not be released, which</font></font></nobr></div>
<div style="position:absolute;top:15174;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">theoretically can lead to unintended consequences. </font><font style="vertical-align: inherit;">Therefore, in Python it is not possible</font></font></nobr></div>
<div style="position:absolute;top:15196;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a stream termination function. </font><font style="vertical-align: inherit;">It is very important to do it right in</font></font></nobr></div>
<div style="position:absolute;top:15218;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">functions of the thread itself. </font><font style="vertical-align: inherit;">In the above example, a special</font></font></nobr></div>
<div style="position:absolute;top:15239;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">value is None, and the thread function exits when checking the condition.</font></font></nobr></div>
<div style="position:absolute;top:15283;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using queues makes the code of the executable program simpler. </font><font style="vertical-align: inherit;">And, by</font></font></nobr></div>
<div style="position:absolute;top:15304;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possibilities, it is better to design the code in such a way that there is no global</font></font></nobr></div>
<div style="position:absolute;top:15326;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shared resource or state. </font><font style="vertical-align: inherit;">However, sometimes you have to use blocks</font></font></nobr></div>
<div style="position:absolute;top:15348;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rocking.</font></font></nobr></div>
<div style="position:absolute;top:15391;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take an example. </font><font style="vertical-align: inherit;">Suppose we have a Point class, and a Point class</font></font></nobr></div>
<div style="position:absolute;top:15413;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there are x and y coordinates. </font><font style="vertical-align: inherit;">Also, this class has a get method that returns the co-</font></font></nobr></div>
<div style="position:absolute;top:15434;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dinates, and the set method, which sets the new coordinates. </font><font style="vertical-align: inherit;">Suppose we created</font></font></nobr></div>
<div style="position:absolute;top:15456;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">object of class Point and use this object in a large number of threads. </font><font style="vertical-align: inherit;">Some</font></font></nobr></div>
<div style="position:absolute;top:15478;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threads call the getter, others call the setter. </font><font style="vertical-align: inherit;">If there were no locks,</font></font></nobr></div>
<div style="position:absolute;top:15499;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then a situation could arise when one thread changed the value of the x coordinate, and another</font></font></nobr></div>
<div style="position:absolute;top:15521;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second thread at this time returned the x and y coordinates. </font><font style="vertical-align: inherit;">We got an inconsistent state</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:15563;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:15619;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="14"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 14</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:15656;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:15709;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an object with one coordinate changed and the other not.</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:15750;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Thread synchronization, race condition</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:15793;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font></nobr></div>
<div style="position:absolute;top:15837;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><font color="#2b91b0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(object):</font></font></font></nobr></div>
<div style="position:absolute;top:15858;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init __ (self, x, y):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:15880;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.set (x, y)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:15923;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get (self):</font></font></font></nobr></div>
<div style="position:absolute;top:15945;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(self.x, self.y)</font></font></font></nobr></div>
<div style="position:absolute;top:15988;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set (self, x, y):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:16010;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.x = x</font></font></nobr></div>
<div style="position:absolute;top:16032;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.y = y</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:16075;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># use in threads</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:16097;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_point = Point (10, 20)</font></font></nobr></div>
<div style="position:absolute;top:16118;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_point.set (15, 10)</font></font></nobr></div>
<div style="position:absolute;top:16140;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_point.get ()</font></font></nobr></div>
<div style="position:absolute;top:16184;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To avoid such situations, locks are needed. </font><font style="vertical-align: inherit;">To create a lock, use</font></font></nobr></div>
<div style="position:absolute;top:16205;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use the threading.RLock () method. </font><font style="vertical-align: inherit;">We create a lock object, and now when entering</font></font></nobr></div>
<div style="position:absolute;top:16227;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the context manager, we capture the lock, and on exit, the lock is released.</font></font></nobr></div>
<div style="position:absolute;top:16249;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is given:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:16751;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fourteen</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:16807;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="15"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 15</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:16844;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:16897;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Synchronization of threads, blocking</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:16940;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font></nobr></div>
<div style="position:absolute;top:16984;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><font color="#2b91b0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(object):</font></font></font></nobr></div>
<div style="position:absolute;top:17005;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init __ (self, x, y):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17027;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.mutex = threading.RLock ()</font></font></nobr></div>
<div style="position:absolute;top:17049;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.set (x, y)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:17092;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get (self):</font></font></font></nobr></div>
<div style="position:absolute;top:17114;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.mutex:</font></font></font></nobr></div>
<div style="position:absolute;top:17135;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(self.x, self.y)</font></font></font></nobr></div>
<div style="position:absolute;top:17179;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set (self, x, y):</font></font></font></nobr></div>
<div style="position:absolute;top:17200;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.mutex:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17222;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.x = x</font></font></nobr></div>
<div style="position:absolute;top:17244;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.y = y</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:17287;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># use in threads</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17309;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_point = Point (10, 20)</font></font></nobr></div>
<div style="position:absolute;top:17330;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_point.set (15, 10)</font></font></nobr></div>
<div style="position:absolute;top:17352;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_point.get ()</font></font></nobr></div>
<div style="position:absolute;top:17396;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, you can easily and conveniently create locks in Python. </font><font style="vertical-align: inherit;">Similar systems</font></font></nobr></div>
<div style="position:absolute;top:17418;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tuations are sometimes called a race for resources, or a race condition.</font></font></nobr></div>
<div style="position:absolute;top:17461;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at another use case for locks. </font><font style="vertical-align: inherit;">They can be used</font></font></nobr></div>
<div style="position:absolute;top:17483;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without a context manager. </font><font style="vertical-align: inherit;">For example, we create objects of the RLock class and then</font></font></nobr></div>
<div style="position:absolute;top:17504;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we call the acquire methods to acquire or acquire the lock, and the release method</font></font></nobr></div>
<div style="position:absolute;top:17526;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in order to release it:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:17567;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Synchronization of threads, blocking</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:17610;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17675;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a = threading.RLock ()</font></font></nobr></div>
<div style="position:absolute;top:17697;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b = threading.RLock ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:17740;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo ():</font></font></font></nobr></div>
<div style="position:absolute;top:17762;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17784;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a.acquire ()</font></font></nobr></div>
<div style="position:absolute;top:17805;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b.acquire ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:17827;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finally </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:17849;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a.release ()</font></font></nobr></div>
<div style="position:absolute;top:17870;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b.release ()</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:17939;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fifteen</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:17995;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="16"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 16</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:18032;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:18085;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we run such code in a large number of processes, then sooner or later</font></font></nobr></div>
<div style="position:absolute;top:18107;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this will lead to a situation called deadlock. </font><font style="vertical-align: inherit;">The point is that we liberate</font></font></nobr></div>
<div style="position:absolute;top:18128;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">locks in the wrong sequence. </font><font style="vertical-align: inherit;">You need to take this into account in your programs</font></font></nobr></div>
<div style="position:absolute;top:18150;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swing and give preference to using the context manager when working with the blo-</font></font></nobr></div>
<div style="position:absolute;top:18172;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with kirovi. </font><font style="vertical-align: inherit;">Also in Python there is also an object of the Lock class, not RLock, but</font></font></nobr></div>
<div style="position:absolute;top:18193;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is more respectful to use RLock objects - they allow you to get</font></font></nobr></div>
<div style="position:absolute;top:18215;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blocking twice.</font></font></nobr></div>
<div style="position:absolute;top:18258;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is another mechanism in Python for synchronizing threads - it is called</font></font></nobr></div>
<div style="position:absolute;top:18280;left:85"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conditional variables</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Let's take a look at the Queue class. </font><font style="vertical-align: inherit;">This is the queue with which to</font></font></nobr></div>
<div style="position:absolute;top:18302;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will work in a large number of threads. </font><font style="vertical-align: inherit;">It has put and get operations, and finally</font></font></nobr></div>
<div style="position:absolute;top:18323;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">but it does have a size. </font><font style="vertical-align: inherit;">If we perform a put operation, and there are already enough</font></font></nobr></div>
<div style="position:absolute;top:18345;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a large number of elements, then we need to wait until this number decreases</font></font></nobr></div>
<div style="position:absolute;top:18367;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xia. </font><font style="vertical-align: inherit;">The question is how long to wait? </font><font style="vertical-align: inherit;">Unknown. </font><font style="vertical-align: inherit;">To solve a similar problem, you can use</font></font></nobr></div>
<div style="position:absolute;top:18388;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call conditional variables. </font><font style="vertical-align: inherit;">Conditional variable threading.Condition gets in</font></font></nobr></div>
<div style="position:absolute;top:18410;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constructor blocking object self._mutex (it is by default, but if conditionals</font></font></nobr></div>
<div style="position:absolute;top:18432;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variables are interdependent, you must use a shared lock). </font><font style="vertical-align: inherit;">And at</font></font></nobr></div>
<div style="position:absolute;top:18454;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using these conditional variables, it is easy and convenient to wait for events by calling</font></font></nobr></div>
<div style="position:absolute;top:18475;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wait and notify all threads that are now waiting for this event to occur using</font></font></nobr></div>
<div style="position:absolute;top:18497;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the following notify functions:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:18538;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Thread sync, conditional variables</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:18581;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><font color="#2b91b0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queue </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(object):</font></font></font></nobr></div>
<div style="position:absolute;top:18603;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init __ (self, size = 5):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:18624;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._size = size</font></font></nobr></div>
<div style="position:absolute;top:18646;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._queue = []</font></font></nobr></div>
<div style="position:absolute;top:18668;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._mutex = threading.RLock ()</font></font></nobr></div>
<div style="position:absolute;top:18689;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._empty = threading.Condition (self._mutex)</font></font></nobr></div>
<div style="position:absolute;top:18711;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._full = threading.Condition (self._mutex)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:18754;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">put (self, val):</font></font></font></nobr></div>
<div style="position:absolute;top:18776;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._full:</font></font></font></nobr></div>
<div style="position:absolute;top:18798;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len (self._queue)&gt; = self._size:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:18819;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._full.wait ()</font></font></nobr></div>
<div style="position:absolute;top:18863;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._queue.append (val)</font></font></nobr></div>
<div style="position:absolute;top:18884;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._empty.notify ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:18928;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get (self):</font></font></font></nobr></div>
<div style="position:absolute;top:18949;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._empty:</font></font></font></nobr></div>
<div style="position:absolute;top:18971;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len (self._queue) == 0:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:18993;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._empty.wait ()</font></font></nobr></div>
<div style="position:absolute;top:19036;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret = self._queue.pop (0)</font></font></nobr></div>
<div style="position:absolute;top:19058;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self._full.notify ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:19079;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ret</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:19127;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sixteen</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:19183;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="17"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 17</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:19220;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19273;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, you can implement a queue in Python that works in multithreading</font></font></nobr></div>
<div style="position:absolute;top:19295;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noah program.</font></font></nobr></div>
<div style="position:absolute;top:19338;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All mechanisms of blocking and data exchange between threads are also valid for</font></font></nobr></div>
<div style="position:absolute;top:19360;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processes, but instead of the threading module, you need to use multiprocessing.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:19435;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.5. </font><font style="vertical-align: inherit;">Global interpreter lock</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19474;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's talk about what the global interpreter lock is, or, as it is abbreviated</font></font></nobr></div>
<div style="position:absolute;top:19495;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is commonly referred to as GIL. </font><font style="vertical-align: inherit;">The GIL is very closely related to thread execution. </font><font style="vertical-align: inherit;">Many developments</font></font></nobr></div>
<div style="position:absolute;top:19517;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chicks know about the GIL only that it is some kind of thing that does not allow at the same time</font></font></nobr></div>
<div style="position:absolute;top:19539;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two threads run on one processor core, even if these cores are</font></font></nobr></div>
<div style="position:absolute;top:19560;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">litter a little. </font><font style="vertical-align: inherit;">However, the GIL is primarily intended to protect memory</font></font></nobr></div>
<div style="position:absolute;top:19582;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interpreter from destruction and makes all memory operations atomic. </font><font style="vertical-align: inherit;">let's</font></font></nobr></div>
<div style="position:absolute;top:19604;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consider the following program:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:19644;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cpu bound programm</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:19688;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thread</font></font></font></nobr></div>
<div style="position:absolute;top:19709;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time</font></font></font></nobr></div>
<div style="position:absolute;top:19753;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count (n):</font></font></font></nobr></div>
<div style="position:absolute;top:19774;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n&gt; 0:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19796;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n - = 1</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:19839;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># series run</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19861;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t0 = time.time ()</font></font></nobr></div>
<div style="position:absolute;top:19883;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count (100_000_000)</font></font></nobr></div>
<div style="position:absolute;top:19904;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count (100_000_000)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:19926;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(time.time () - t0)</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:19969;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># parallel run</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:19991;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t0 = time.time ()</font></font></nobr></div>
<div style="position:absolute;top:20013;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th1 = Thread (target = count, args = (100_000_000,))</font></font></nobr></div>
<div style="position:absolute;top:20034;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th2 = Thread (target = count, args = (100_000_000,))</font></font></nobr></div>
<div style="position:absolute;top:20078;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th1.start (); </font><font style="vertical-align: inherit;">th2.start ()</font></font></nobr></div>
<div style="position:absolute;top:20099;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th1.join (); </font><font style="vertical-align: inherit;">th2.join ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:20121;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(time.time () - t0)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:20165;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can see with the top command that this example consumes almost 100%</font></font></nobr></div>
<div style="position:absolute;top:20186;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU on one core. </font><font style="vertical-align: inherit;">Let's go back to the program and see what it does. </font><font style="vertical-align: inherit;">Previous</font></font></nobr></div>
<div style="position:absolute;top:20208;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, we have a function count, which in a loop decreases the value of the counter to</font></font></nobr></div>
<div style="position:absolute;top:20230;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scratch. </font><font style="vertical-align: inherit;">We need to make two calls to this function with the value 100_000_000</font></font></nobr></div>
<div style="position:absolute;top:20251;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and track how long it will take to complete two functions with this counter. </font><font style="vertical-align: inherit;">Function</font></font></nobr></div>
<div style="position:absolute;top:20273;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consumes only the central processor and does not perform any I / O operations,</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:20315;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:20371;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="18"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 18</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:20408;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:20461;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not go online. </font><font style="vertical-align: inherit;">For comparison, we will execute this function on a stream. </font><font style="vertical-align: inherit;">Let's create two streams</font></font></nobr></div>
<div style="position:absolute;top:20483;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the methods of the threading module already known to us. </font><font style="vertical-align: inherit;">Let's transfer this</font></font></nobr></div>
<div style="position:absolute;top:20504;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function, the same arguments, start our threads, wait for them to complete-</font></font></nobr></div>
<div style="position:absolute;top:20526;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the join method, and display the number of seconds that were spent on</font></font></nobr></div>
<div style="position:absolute;top:20548;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doing the work of these two threads:</font></font></nobr></div>
<div style="position:absolute;top:20587;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.281397104263306</font></font></nobr></div>
<div style="position:absolute;top:20608;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.86177659034729</font></font></nobr></div>
<div style="position:absolute;top:20647;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can see that parallel execution with threads took longer.</font></font></nobr></div>
<div style="position:absolute;top:20669;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How so? </font><font style="vertical-align: inherit;">Then why are streams needed, and why is this happening? </font><font style="vertical-align: inherit;">It's all about the global</font></font></nobr></div>
<div style="position:absolute;top:20690;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blocking the interpreter.</font></font></nobr></div>
<div style="position:absolute;top:20734;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The fact is that threads, when executing their code, acquire a lock each time.</font></font></nobr></div>
<div style="position:absolute;top:20755;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interpreter. </font><font style="vertical-align: inherit;">If we have a CPU-bound task (this is how tasks that consume</font></font></nobr></div>
<div style="position:absolute;top:20777;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only CPU resources), then the code written using threads in Python,</font></font></nobr></div>
<div style="position:absolute;top:20799;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be ineffective. </font><font style="vertical-align: inherit;">It will run slower than the code that is run after-</font></font></nobr></div>
<div style="position:absolute;top:20820;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">consistently. </font><font style="vertical-align: inherit;">Nevertheless, if we replace the code of our function, for example, with a task,</font></font></nobr></div>
<div style="position:absolute;top:20842;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which requires an I / O operation, then we will notice a large increase in the total time</font></font></nobr></div>
<div style="position:absolute;top:20864;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of execution, if you compare sequential execution and execution in the</font></font></nobr></div>
<div style="position:absolute;top:20885;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dax.</font></font></nobr></div>
<div style="position:absolute;top:20929;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's schematically depict the flow execution process. </font><font style="vertical-align: inherit;">There is a thread in which to execute-</font></font></nobr></div>
<div style="position:absolute;top:20950;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Python code is given, and each time the Python interpreter tries to get the global block</font></font></nobr></div>
<div style="position:absolute;top:20972;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the interpreter. </font><font style="vertical-align: inherit;">If Python is doing I / O operation or system</font></font></nobr></div>
<div style="position:absolute;top:20994;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call, it releases the lock, and then execution occurs without blocking. </font><font style="vertical-align: inherit;">therefore</font></font></nobr></div>
<div style="position:absolute;top:21015;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if there are many such threads, all tasks with I / O, waiting for completion</font></font></nobr></div>
<div style="position:absolute;top:21037;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for I / O operations will parallelize very well:</font></font></nobr></div>
<div style="position:absolute;top:21098;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># how is the thread executed?</font></font></nobr></div>
<div style="position:absolute;top:21141;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21141;left:160"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></nobr></div>
<div style="position:absolute;top:21141;left:236"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21141;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></nobr></div>
<div style="position:absolute;top:21141;left:537"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21141;left:655"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></nobr></div>
<div style="position:absolute;top:21141;left:709"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21163;left:107"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run | ------ |</font></font></nobr></div>
<div style="position:absolute;top:21163;left:289"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run</font></font></nobr></div>
<div style="position:absolute;top:21163;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| -------------- |</font></font></nobr></div>
<div style="position:absolute;top:21163;left:580"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run</font></font></nobr></div>
<div style="position:absolute;top:21163;left:655"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| ---- | </font><font style="vertical-align: inherit;">run</font></font></nobr></div>
<div style="position:absolute;top:21184;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------&gt; | </font><font style="vertical-align: inherit;">IO | -----------&gt; |</font></font></nobr></div>
<div style="position:absolute;top:21184;left:451"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IO</font></font></nobr></div>
<div style="position:absolute;top:21184;left:537"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| ---------&gt; | </font><font style="vertical-align: inherit;">IO | -----&gt;</font></font></nobr></div>
<div style="position:absolute;top:21206;left:160"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| ------ |</font></font></nobr></div>
<div style="position:absolute;top:21206;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| -------------- |</font></font></nobr></div>
<div style="position:absolute;top:21206;left:655"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| ---- |</font></font></nobr></div>
<div style="position:absolute;top:21228;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21228;left:160"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></nobr></div>
<div style="position:absolute;top:21228;left:236"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21228;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></nobr></div>
<div style="position:absolute;top:21228;left:537"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21228;left:655"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></nobr></div>
<div style="position:absolute;top:21228;left:709"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></nobr></div>
<div style="position:absolute;top:21271;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a - acquire GIL</font></font></nobr></div>
<div style="position:absolute;top:21293;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r - release GIL</font></font></nobr></div>
<div style="position:absolute;top:21331;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This must be taken into account in the tasks in which you will use threads or processes.</font></font></nobr></div>
<div style="position:absolute;top:21353;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sy. </font><font style="vertical-align: inherit;">The GIL is implemented internally as a normal non-recursive lock or class object</font></font></nobr></div>
<div style="position:absolute;top:21375;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading.Lock. </font><font style="vertical-align: inherit;">All threads sleep for five milliseconds, waiting to acquire locks.</font></font></nobr></div>
<div style="position:absolute;top:21396;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ki, and if one main thread is running, then it does not require the release of this global</font></font></nobr></div>
<div style="position:absolute;top:21418;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interpreter locks. </font><font style="vertical-align: inherit;">So, in this video, we discussed what the GIL is and how</font></font></nobr></div>
<div style="position:absolute;top:21439;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">he has a connection to threads in Python. </font><font style="vertical-align: inherit;">For example, Python streams are regular streams, or POSIX</font></font></nobr></div>
<div style="position:absolute;top:21461;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threads, but limited by the global interpreter lock. </font><font style="vertical-align: inherit;">All streams</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:21503;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eighteen</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:21559;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="19"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 19</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:21596;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:21649;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performed with GIL capture, but for system calls and GIL I / O</font></font></nobr></div>
<div style="position:absolute;top:21671;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not needed. </font><font style="vertical-align: inherit;">So, we looked at the questions about how threads and processes work, and in</font></font></nobr></div>
<div style="position:absolute;top:21692;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following sections, we will look at how sockets work and how to work with networking with</font></font></nobr></div>
<div style="position:absolute;top:21714;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changing the knowledge gained about flows and processes.</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:21796;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3. </font><font style="vertical-align: inherit;">Networking, sockets</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:21850;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.1. </font><font style="vertical-align: inherit;">Sockets, client-server</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:21888;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the next sections, we will explore how sockets are arranged and how networking works.</font></font></nobr></div>
<div style="position:absolute;top:21910;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programs. </font><font style="vertical-align: inherit;">Sockets are a cross-platform mechanism for exchanging data between</font></font></nobr></div>
<div style="position:absolute;top:21932;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate processes. </font><font style="vertical-align: inherit;">These processes can run on different servers, they can</font></font></nobr></div>
<div style="position:absolute;top:21953;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">be written in different languages, and, above all, a Python program that is used</font></font></nobr></div>
<div style="position:absolute;top:21975;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calls the socket mechanism, performs system calls and interacts with the kernel</font></font></nobr></div>
<div style="position:absolute;top:21997;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the rational system. </font><font style="vertical-align: inherit;">As a rule, for the organization of network interaction, a ser-</font></font></nobr></div>
<div style="position:absolute;top:22018;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver, which initially creates some kind of connection and starts "listening" to all requests,</font></font></nobr></div>
<div style="position:absolute;top:22040;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that enter it, and a client program that connects to the server and from-</font></font></nobr></div>
<div style="position:absolute;top:22062;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edits the data it needs.</font></font></nobr></div>
<div style="position:absolute;top:22105;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a look at an example of a server program. </font><font style="vertical-align: inherit;">To create a socket, we must</font></font></nobr></div>
<div style="position:absolute;top:22127;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import module socket. </font><font style="vertical-align: inherit;">Next, we must create an object of type socket from the module</font></font></nobr></div>
<div style="position:absolute;top:22149;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket. </font><font style="vertical-align: inherit;">It is necessary to pass some parameters to it. </font><font style="vertical-align: inherit;">In this case, it is some</font></font></nobr></div>
<div style="position:absolute;top:22170;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the second family is the address family AF_INET, as well as the socket type (stream socket). </font><font style="vertical-align: inherit;">(Full</font></font></nobr></div>
<div style="position:absolute;top:22192;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">information on socket types and address family types can be found in the doc-</font></font></nobr></div>
<div style="position:absolute;top:22213;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python tations, or in the documentation about how the network works in the operating system</font></font></nobr></div>
<div style="position:absolute;top:22235;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux.) So, we've created a socket object. </font><font style="vertical-align: inherit;">Next, we must call the bind method. </font><font style="vertical-align: inherit;">Into method</font></font></nobr></div>
<div style="position:absolute;top:22257;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bind, we must pass a certain address pair - this is a host and a port. </font><font style="vertical-align: inherit;">As a host in</font></font></nobr></div>
<div style="position:absolute;top:22278;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in this case, we pass 127.0.0.1 - our server will listen to all incoming connections</font></font></nobr></div>
<div style="position:absolute;top:22300;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only locally on one machine. </font><font style="vertical-align: inherit;">If we indicate an empty line, or the address</font></font></nobr></div>
<div style="position:absolute;top:22322;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0, then our server will listen to incoming connections from all interfaces. </font><font style="vertical-align: inherit;">Port</font></font></nobr></div>
<div style="position:absolute;top:22343;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- this is some kind of integer constant, there are some reserved ports</font></font></nobr></div>
<div style="position:absolute;top:22365;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you are, for example, port 80 (usually an HTTP server runs on it), port 43, port 443.</font></font></nobr></div>
<div style="position:absolute;top:22387;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typically, ports numbered before 2000 are system ports, and we must use</font></font></nobr></div>
<div style="position:absolute;top:22408;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are addresses greater than 2000, but the maximum port value is 65535.</font></font></nobr></div>
<div style="position:absolute;top:22452;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So the bind system call has registered our address pair in the operating room</font></font></nobr></div>
<div style="position:absolute;top:22473;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system. </font><font style="vertical-align: inherit;">Further, in order to start accepting connections, we must call the method</font></font></nobr></div>
<div style="position:absolute;top:22495;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listen. </font><font style="vertical-align: inherit;">The listen method has an optional parameter - this is the so-called backlog,</font></font></nobr></div>
<div style="position:absolute;top:22517;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or the size of the queue of incoming connections that have not yet been processed, for which</font></font></nobr></div>
<div style="position:absolute;top:22538;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the accept method was called. </font><font style="vertical-align: inherit;">If our server does not have time to receive incoming messages</font></font></nobr></div>
<div style="position:absolute;top:22560;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unity, then all these connections will be accumulated in the backlog, and if it exceeds the maximum</font></font></nobr></div>
<div style="position:absolute;top:22582;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minimum value, the operating system will issue a ConnectionRefused error for</font></font></nobr></div>
<div style="position:absolute;top:22603;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client program. </font><font style="vertical-align: inherit;">Next, we must call the accept method to start accepting</font></font></nobr></div>
<div style="position:absolute;top:22625;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mother is an incoming client connection. </font><font style="vertical-align: inherit;">The accept system call is blocked by default.</font></font></nobr></div>
<div style="position:absolute;top:22647;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">until a client connection appears. </font><font style="vertical-align: inherit;">So if the client calls</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:22691;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nineteen</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:22747;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="20"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 20</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:22784;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:22837;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connect method, then our accept method will return us an object that will be fully</font></font></nobr></div>
<div style="position:absolute;top:22859;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duplex channel. </font><font style="vertical-align: inherit;">This object will have available methods for writing to this channel and</font></font></nobr></div>
<div style="position:absolute;top:22880;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readings. </font><font style="vertical-align: inherit;">In our example, we will call reading from our</font></font></nobr></div>
<div style="position:absolute;top:22902;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full duplex channel. </font><font style="vertical-align: inherit;">If we have not read anything, it will mean that the client</font></font></nobr></div>
<div style="position:absolute;top:22924;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">closed the connection and the server also needs to stop working. </font><font style="vertical-align: inherit;">The data that we</font></font></nobr></div>
<div style="position:absolute;top:22945;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read from the channel, we output to the console. </font><font style="vertical-align: inherit;">After we have finished working with our</font></font></nobr></div>
<div style="position:absolute;top:22967;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client, we call the close method on our object, which is</font></font></nobr></div>
<div style="position:absolute;top:22989;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full duplex channel, and also close the socket that is listening for new connections from</font></font></nobr></div>
<div style="position:absolute;top:23010;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client side:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:23050;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># create a socket, server</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:23093;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:23137;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># https://docs.python.org/3/library/socket.html</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23158;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock = socket.socket (socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:23180;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:23180;left:455"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># max port 65535</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23202;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen (socket.SOMAXCONN)</font></font></nobr></div>
<div style="position:absolute;top:23245;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn, addr = sock.accept ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:23267;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23288;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn.recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:23310;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if not </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data:</font></font></font></nobr></div>
<div style="position:absolute;top:23332;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:23353;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># process data</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:23375;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23418;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn.close ()</font></font></nobr></div>
<div style="position:absolute;top:23440;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.close ()</font></font></nobr></div>
<div style="position:absolute;top:23484;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a look at the client side code. </font><font style="vertical-align: inherit;">To establish a connection to the server</font></font></nobr></div>
<div style="position:absolute;top:23506;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rum, we have to create an object of type socket.socket. </font><font style="vertical-align: inherit;">By default, a stream is created.</font></font></nobr></div>
<div style="position:absolute;top:23527;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the output socket with the address family AF_INET. </font><font style="vertical-align: inherit;">After that, we must call the method</font></font></nobr></div>
<div style="position:absolute;top:23549;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connect. </font><font style="vertical-align: inherit;">Connect will block until the server calls</font></font></nobr></div>
<div style="position:absolute;top:23571;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accept method. </font><font style="vertical-align: inherit;">After the connect system call has finished, our socket is ready for</font></font></nobr></div>
<div style="position:absolute;top:23592;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">work, and you can call the send, sendall, or recv methods for it to receive</font></font></nobr></div>
<div style="position:absolute;top:23614;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data from the server. </font><font style="vertical-align: inherit;">After we have finished working with our client socket,</font></font></nobr></div>
<div style="position:absolute;top:23636;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you need to call the close method:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:23675;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># create socket, client</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:23718;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:23762;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock = socket.socket ()</font></font></nobr></div>
<div style="position:absolute;top:23783;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.connect (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:23805;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.sendall ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ping"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .encode ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ))</font></font></nobr></div>
<div style="position:absolute;top:23827;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.close ()</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:23879;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twenty</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:23935;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="21"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 21</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:23972;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24025;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Python, there is a shorter notation for creating a client socket is you-</font></font></nobr></div>
<div style="position:absolute;top:24047;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The call to the module method socket create_connection. </font><font style="vertical-align: inherit;">In create_connection, we pass</font></font></nobr></div>
<div style="position:absolute;top:24068;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">address pair and optional timeout (which we will talk about in the next</font></font></nobr></div>
<div style="position:absolute;top:24090;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sections). </font><font style="vertical-align: inherit;">This call returns us a connection ready to do</font></font></nobr></div>
<div style="position:absolute;top:24112;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sending or receiving data.</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:24151;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># create socket, client</font></font></nobr></div>
<div style="position:absolute;top:24173;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># shorter notation</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24216;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock = socket.create_connection (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:24238;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.sendall ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ping"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .encode ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ))</font></font></nobr></div>
<div style="position:absolute;top:24260;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.close ()</font></font></nobr></div>
<div style="position:absolute;top:24303;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can now start the server and then the client, which will send the by-</font></font></nobr></div>
<div style="position:absolute;top:24325;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the line "ping" (please note that when working with data over the network, we</font></font></nobr></div>
<div style="position:absolute;top:24347;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are forced to send bytes, not strings).</font></font></nobr></div>
<div style="position:absolute;top:24390;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we said, socket is a cross-platform mechanism and is optional</font></font></nobr></div>
<div style="position:absolute;top:24412;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the client program and the server must be written in the same language. </font><font style="vertical-align: inherit;">Our example</font></font></nobr></div>
<div style="position:absolute;top:24434;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will work even if we use the telnet program instead of the client.</font></font></nobr></div>
<div style="position:absolute;top:24477;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connections and sockets must be closed properly. </font><font style="vertical-align: inherit;">Therefore, in Python there is</font></font></nobr></div>
<div style="position:absolute;top:24499;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a more convenient mechanism for working with sockets in the form of context managers. </font><font style="vertical-align: inherit;">Yes-</font></font></nobr></div>
<div style="position:absolute;top:24520;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consider an example in which we perform the same tasks, but use</font></font></nobr></div>
<div style="position:absolute;top:24542;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's get a context manager. </font><font style="vertical-align: inherit;">So, we use the with construct on the server side</font></font></nobr></div>
<div style="position:absolute;top:24564;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.socket, create our socket object, call the bind, listen methods. </font><font style="vertical-align: inherit;">Per-</font></font></nobr></div>
<div style="position:absolute;top:24585;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then, in an endless loop, we call accept and receive new connections from clients.</font></font></nobr></div>
<div style="position:absolute;top:24607;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the resulting object, we use the context manager again and we don't care</font></font></nobr></div>
<div style="position:absolute;top:24629;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">about calls to the close method:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:24669;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># create a socket, context manager</font></font></nobr></div>
<div style="position:absolute;top:24691;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#server</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:24712;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:24756;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.socket ()</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24777;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">""</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:24799;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:24842;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24864;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn, addr = sock.accept ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:24886;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn:</font></font></font></nobr></div>
<div style="position:absolute;top:24907;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:24929;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn.recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:24951;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if not </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data:</font></font></font></nobr></div>
<div style="position:absolute;top:24972;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:24994;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:25067;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:25123;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="22"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 22</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:25160;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:25213;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the context manager completes its work, it will automatically call</font></font></nobr></div>
<div style="position:absolute;top:25235;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Close method for the objects we need. </font><font style="vertical-align: inherit;">This is very convenient, and it allows you to</font></font></nobr></div>
<div style="position:absolute;top:25256;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you have fewer errors when working with sockets. </font><font style="vertical-align: inherit;">On the client side we are again</font></font></nobr></div>
<div style="position:absolute;top:25278;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use the context manager to call socket.create.connection:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:25318;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># client</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:25339;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:25383;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.create_connection (( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 10001))</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:25404;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.sendall ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ping"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .encode ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ))</font></font></nobr></div>
<div style="position:absolute;top:25448;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is preferable to work with context managers when writing client-</font></font></nobr></div>
<div style="position:absolute;top:25470;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server programs in Python.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:25546;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.2. </font><font style="vertical-align: inherit;">Timeouts and network error handling</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:25584;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The network may not always work stably, therefore, in network programs it is necessary</font></font></nobr></div>
<div style="position:absolute;top:25606;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handle various errors. </font><font style="vertical-align: inherit;">Let's take a look at a training example with processing</font></font></nobr></div>
<div style="position:absolute;top:25628;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mistakes. </font><font style="vertical-align: inherit;">Let's take a look at the slightly modified server code from the previous section. </font><font style="vertical-align: inherit;">Here</font></font></nobr></div>
<div style="position:absolute;top:25649;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after we got the connection with the sock.accept () command, we set-</font></font></nobr></div>
<div style="position:absolute;top:25671;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we impose timeout with the settimeout command. </font><font style="vertical-align: inherit;">The default timeout value is None,</font></font></nobr></div>
<div style="position:absolute;top:25693;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a value of 0 will put the socket into non-blocking mode, which we will talk about</font></font></nobr></div>
<div style="position:absolute;top:25714;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">later. </font><font style="vertical-align: inherit;">We set the timeout to 5 seconds:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:25755;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># socket creation, timeouts and error handling</font></font></nobr></div>
<div style="position:absolute;top:25777;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#server</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:25799;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:25842;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.socket ()</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:25864;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">""</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:25885;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:25907;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:25929;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn, addr = sock.accept ()</font></font></nobr></div>
<div style="position:absolute;top:25950;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn.settimeout (5) </font></font><font color="#008000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># timeout: = None | 0 | gt 0</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:25972;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn:</font></font></font></nobr></div>
<div style="position:absolute;top:25994;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
<div style="position:absolute;top:26015;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26037;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn.recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:26059;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">except </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.timeout:</font></font></font></nobr></div>
<div style="position:absolute;top:26080;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"close connection by timeout" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:26102;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:26145;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if not </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data:</font></font></font></nobr></div>
<div style="position:absolute;top:26167;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:26189;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:26255;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:26311;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="23"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 23</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:26348;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26401;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, if after calling recv we do not receive data for 5 seconds, it will be</font></font></nobr></div>
<div style="position:absolute;top:26423;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a socket.timeout exception was thrown. </font><font style="vertical-align: inherit;">Then we close the connection.</font></font></nobr></div>
<div style="position:absolute;top:26466;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consider the code on the client. </font><font style="vertical-align: inherit;">There is a connect timeout and a socket read timeout on the client.</font></font></nobr></div>
<div style="position:absolute;top:26488;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We set the connect timeout in the create_connection method, it will propagate</font></font></nobr></div>
<div style="position:absolute;top:26509;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only to establish a connection with our server. </font><font style="vertical-align: inherit;">After the connection is</font></font></nobr></div>
<div style="position:absolute;top:26531;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installed, we can set socket read timeout on all operations with our socket:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:26572;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># socket creation, timeouts and error handling</font></font></nobr></div>
<div style="position:absolute;top:26594;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># client</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:26615;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:26659;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.create_connection (( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 10001), 5)</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:26680;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># set socket read timeout</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26702;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.settimeout (2)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:26724;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26745;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.sendall ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ping"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .encode ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ))</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:26767;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">except </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.timeout:</font></font></font></nobr></div>
<div style="position:absolute;top:26789;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"send data timeout" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:26810;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">except </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.error</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ex:</font></font></font></nobr></div>
<div style="position:absolute;top:26832;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"send data error:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ex)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:26876;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There may also be other exceptions that need to be handled as well. </font><font style="vertical-align: inherit;">Basic</font></font></nobr></div>
<div style="position:absolute;top:26898;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first class for these exceptions is socket.error.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:26973;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3.3. </font><font style="vertical-align: inherit;">Handling multiple connections</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:27011;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, in the previous sections, we looked at simple client-server programs.</font></font></nobr></div>
<div style="position:absolute;top:27033;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and tried to organize the interaction between the two processes. </font><font style="vertical-align: inherit;">What if</font></font></nobr></div>
<div style="position:absolute;top:27054;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will there be several or not several, but a lot of these processes? </font><font style="vertical-align: inherit;">If we accepted the connection</font></font></nobr></div>
<div style="position:absolute;top:27076;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">knowledge and start processing it in the same control flow, we cannot accept</font></font></nobr></div>
<div style="position:absolute;top:27098;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mother of new connections. </font><font style="vertical-align: inherit;">If we have a large number of clients, then all the rest</font></font></nobr></div>
<div style="position:absolute;top:27119;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clients will have to wait for us to finish the first connection. </font><font style="vertical-align: inherit;">What kind</font></font></nobr></div>
<div style="position:absolute;top:27141;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Are there approaches to solving this problem?</font></font></nobr></div>
<div style="position:absolute;top:27184;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, we can create a process or thread to handle a separate connection</font></font></nobr></div>
<div style="position:absolute;top:27206;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and execute the code to process it in this process or thread. </font><font style="vertical-align: inherit;">If we create 10,000</font></font></nobr></div>
<div style="position:absolute;top:27228;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processes, this will have a number of disadvantages. </font><font style="vertical-align: inherit;">At a minimum, this will require very pain</font></font></nobr></div>
<div style="position:absolute;top:27249;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resources from our operating system, as well as the creation of the process itself is</font></font></nobr></div>
<div style="position:absolute;top:27271;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xia "expensive" operation. </font><font style="vertical-align: inherit;">However, this approach is sometimes used, and if you have</font></font></nobr></div>
<div style="position:absolute;top:27293;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a small number of connections, the plus is that you can use all the poison</font></font></nobr></div>
<div style="position:absolute;top:27314;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operating system and distribute processing across all cores on the server.</font></font></nobr></div>
<div style="position:absolute;top:27358;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we process new connections in threads, then, as we remember, all</font></font></nobr></div>
<div style="position:absolute;top:27379;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threads run in Python on a single core, and they are restricted by the GIL. </font><font style="vertical-align: inherit;">Sooner or later we</font></font></nobr></div>
<div style="position:absolute;top:27401;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will run into the fact that we are missing one core, and our server will respond slowly.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:27443;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:27499;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="24"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 24</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:27536;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:27589;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, on streams, especially if they require I / O, you can</font></font></nobr></div>
<div style="position:absolute;top:27611;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get a sufficiently productive server.</font></font></nobr></div>
<div style="position:absolute;top:27654;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at an example of concurrent processing of network requests using</font></font></nobr></div>
<div style="position:absolute;top:27676;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">streams. </font><font style="vertical-align: inherit;">So, we create a socket, we call our well-known bind and listen methods.</font></font></nobr></div>
<div style="position:absolute;top:27697;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then, in an endless loop, we accept the incoming connection from the client. </font><font style="vertical-align: inherit;">As soon as we</font></font></nobr></div>
<div style="position:absolute;top:27719;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepted this incoming connection, we need to create a thread. </font><font style="vertical-align: inherit;">We do this with the help</font></font></nobr></div>
<div style="position:absolute;top:27741;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">module threading, create an object of class Thread, pass it as an argument</font></font></nobr></div>
<div style="position:absolute;top:27762;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function and our connection, with which we will work further in this function. </font><font style="vertical-align: inherit;">Start-</font></font></nobr></div>
<div style="position:absolute;top:27784;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's go to the stream, but in the main stream we continue to accept new connections:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:27825;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># processing multiple connections at the same time, threads</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:27868;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:27890;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font></nobr></div>
<div style="position:absolute;top:27933;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process_request (conn, addr):</font></font></font></nobr></div>
<div style="position:absolute;top:27955;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"connected client:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, addr)</font></font></font></nobr></div>
<div style="position:absolute;top:27977;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn:</font></font></font></nobr></div>
<div style="position:absolute;top:27998;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28020;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn.recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:28042;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if not </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data:</font></font></font></nobr></div>
<div style="position:absolute;top:28063;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:28085;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
<div style="position:absolute;top:28128;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.socket ()</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28150;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">""</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:28172;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:28193;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28215;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn, addr = sock.accept ()</font></font></nobr></div>
<div style="position:absolute;top:28237;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th = threading.Thread (target = process_request,</font></font></nobr></div>
<div style="position:absolute;top:28258;left:412"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">args = (conn, addr))</font></font></nobr></div>
<div style="position:absolute;top:28280;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th.start ()</font></font></nobr></div>
<div style="position:absolute;top:28324;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the process of processing these connections will deal with I / O, then such</font></font></nobr></div>
<div style="position:absolute;top:28346;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the code will be quite performant. </font><font style="vertical-align: inherit;">However, if one is not enough</font></font></nobr></div>
<div style="position:absolute;top:28367;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th kernel of the operating system, you can parallelize this process. </font><font style="vertical-align: inherit;">Let's consider</font></font></nobr></div>
<div style="position:absolute;top:28389;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here's an example where you can use both threads and processes at the same time. </font><font style="vertical-align: inherit;">So, for that-</font></font></nobr></div>
<div style="position:absolute;top:28411;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th to handle one connection in multiple processes, we need to do</font></font></nobr></div>
<div style="position:absolute;top:28432;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a little trick. </font><font style="vertical-align: inherit;">After we have called the listen method, we must create several</font></font></nobr></div>
<div style="position:absolute;top:28454;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processes, make a fork. </font><font style="vertical-align: inherit;">After we make the fork call, all resources are parent</font></font></nobr></div>
<div style="position:absolute;top:28476;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the process will be completely and completely copied to the child processes, thereby</font></font></nobr></div>
<div style="position:absolute;top:28497;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our child processes will have the same socket. </font><font style="vertical-align: inherit;">If we are in this socket</font></font></nobr></div>
<div style="position:absolute;top:28519;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we bark the accept call and wait for a new connection from the client, then the system call</font></font></nobr></div>
<div style="position:absolute;top:28541;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accept will distribute the new incoming evenly among all child processes</font></font></nobr></div>
<div style="position:absolute;top:28562;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connections, and already further in these child processes, when we caught new connections</font></font></nobr></div>
<div style="position:absolute;top:28584;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nenya, we can already create a thread and handle new connections. </font><font style="vertical-align: inherit;">Let's describe this scheme</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:28631;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:28687;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="25"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 25</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:28724;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28777;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comments in the code:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:28818;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># handling multiple connections at the same time, processes and threads</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:28840;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:28883;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.socket ()</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:28905;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">""</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:28926;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen ()</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:28948;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># creating multiple processes</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:28970;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:28991;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># accept will be distributed "evenly" between processes</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:29013;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn, addr = sock.accept ()</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:29035;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># thread to handle the connection</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:29056;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn:</font></font></font></nobr></div>
<div style="position:absolute;top:29078;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:29100;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn.recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:29121;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if not </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data:</font></font></font></nobr></div>
<div style="position:absolute;top:29143;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:29165;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:29208;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If, again, we create multiple processes that all simultaneously do</font></font></nobr></div>
<div style="position:absolute;top:29230;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system call accept, then by default they will all sleep, and the operating system</font></font></nobr></div>
<div style="position:absolute;top:29252;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will not consume any resources. </font><font style="vertical-align: inherit;">But if a new incoming connection arrives</font></font></nobr></div>
<div style="position:absolute;top:29273;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nenie, the operating system will wake up all of our processes. </font><font style="vertical-align: inherit;">This place has a small</font></font></nobr></div>
<div style="position:absolute;top:29295;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overhead, you need to understand this.</font></font></nobr></div>
<div style="position:absolute;top:29338;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is how our server code might look like on processes:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:29819;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:29875;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="26"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 26</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:29912;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:29965;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># handling multiple connections at the same time, processes and threads</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:30008;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:30030;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threading</font></font></font></nobr></div>
<div style="position:absolute;top:30052;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessing</font></font></font></nobr></div>
<div style="position:absolute;top:30095;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket.socket ()</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:30117;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">""</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:30138;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen ()</font></font></nobr></div>
<div style="position:absolute;top:30182;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workers_count = 3</font></font></nobr></div>
<div style="position:absolute;top:30203;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workers_list = [multiprocessing.Process (target = worker,</font></font></nobr></div>
<div style="position:absolute;top:30225;left:563"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">args = (sock,))</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:30247;left:305"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">range (workers_count)]</font></font></font></nobr></div>
<div style="position:absolute;top:30290;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workers_list:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:30312;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w.start ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:30355;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workers_list:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:30377;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w.join ()</font></font></nobr></div>
<div style="position:absolute;top:30421;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As usual, we create a socket, call the bind and listen methods. </font><font style="vertical-align: inherit;">Then we must</font></font></nobr></div>
<div style="position:absolute;top:30442;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the multiprocessing module, create several worker objects that will</font></font></nobr></div>
<div style="position:absolute;top:30464;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are allowed to process new connections.</font></font></nobr></div>
<div style="position:absolute;top:30507;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a look at the code of our workers. </font><font style="vertical-align: inherit;">So, each worker that will run</font></font></nobr></div>
<div style="position:absolute;top:30529;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schen in a separate process, makes the accept system call. </font><font style="vertical-align: inherit;">All incoming connections</font></font></nobr></div>
<div style="position:absolute;top:30551;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be evenly distributed among workers using the operating system.</font></font></nobr></div>
<div style="position:absolute;top:30572;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And after the connection got into our process, you need to create a stream and transfer</font></font></nobr></div>
<div style="position:absolute;top:30594;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to him the process_request method, which handles the given connection:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:31007;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:31063;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="27"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 27</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:31100;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:31153;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># handling multiple connections at the same time, processes and threads</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:31196;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker (sock):</font></font></font></nobr></div>
<div style="position:absolute;top:31218;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31240;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn, addr = sock.accept ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:31261;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"pid" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, os.getpid ())</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31283;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th = threading.Thread (target = process_request,</font></font></nobr></div>
<div style="position:absolute;top:31305;left:412"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">args = (conn, addr))</font></font></nobr></div>
<div style="position:absolute;top:31326;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th.start ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:31370;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process_request (conn, addr):</font></font></font></nobr></div>
<div style="position:absolute;top:31391;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"connected client:" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, addr)</font></font></font></nobr></div>
<div style="position:absolute;top:31413;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn:</font></font></font></nobr></div>
<div style="position:absolute;top:31435;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31456;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn.recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:31478;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if not </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data:</font></font></font></nobr></div>
<div style="position:absolute;top:31500;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></nobr></div>
<div style="position:absolute;top:31521;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31565;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, using both processes and threads, we can solve problems</font></font></nobr></div>
<div style="position:absolute;top:31587;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blem with GIL and memory problem.</font></font></nobr></div>
</span></font>
<font size="4" face="Times"><span style="font-size:23px;font-family:Times">
<div style="position:absolute;top:31647;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4. </font><font style="vertical-align: inherit;">Asynchronous programming</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:31701;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.1. </font><font style="vertical-align: inherit;">Single thread code execution, select module</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:31740;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The operating system has a select module that allows you to organize</font></font></nobr></div>
<div style="position:absolute;top:31761;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">work with non-blocking I / O. </font><font style="vertical-align: inherit;">I would also like to say that there is</font></font></nobr></div>
<div style="position:absolute;top:31783;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">several mechanisms for polling all file descriptors to organize non-blocking</font></font></nobr></div>
<div style="position:absolute;top:31805;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input / output: select.select, select.poll, select.epoll, and select.kqueue.</font></font></nobr></div>
<div style="position:absolute;top:31826;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All these methods are related to the peculiarities of operating systems. </font><font style="vertical-align: inherit;">For example on Linux like</font></font></nobr></div>
<div style="position:absolute;top:31848;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usually use epoll and we will look at examples based on epoll.</font></font></nobr></div>
<div style="position:absolute;top:31891;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recall that we had the problem of creating a socket and handling multiple incoming</font></font></nobr></div>
<div style="position:absolute;top:31913;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connections at the same time. </font><font style="vertical-align: inherit;">Let's try to do this using the select module.</font></font></nobr></div>
<div style="position:absolute;top:31935;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, suppose we created an object of class socket, called the bind method, called the</font></font></nobr></div>
<div style="position:absolute;top:31956;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listen and were able to call the accept method on two connections. </font><font style="vertical-align: inherit;">We now have two</font></font></nobr></div>
<div style="position:absolute;top:31978;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the connection object is conn1 and conn2, and we need to read or write at the same time</font></font></nobr></div>
<div style="position:absolute;top:32000;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download data from these connections without using threads or processes. </font><font style="vertical-align: inherit;">For this</font></font></nobr></div>
<div style="position:absolute;top:32021;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is necessary to transfer our connection, firstly, to a non-blocking mode with the help of</font></font></nobr></div>
<div style="position:absolute;top:32043;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and call setblocking (0) (equivalent to calling settimeout (0)).</font></font></nobr></div>
<div style="position:absolute;top:32086;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now our sockets are in non-blocking mode, and if we try to read something</font></font></nobr></div>
<div style="position:absolute;top:32108;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from this socket, and there is no data there, then our recv call will not block, but will return some</font></font></nobr></div>
<div style="position:absolute;top:32130;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system error. </font><font style="vertical-align: inherit;">But how do you know which sockets are ready to read and which sockets are ready to be read.</font></font></nobr></div>
<div style="position:absolute;top:32151;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">write data? </font><font style="vertical-align: inherit;">For this, we just need an epoll object. </font><font style="vertical-align: inherit;">We register in</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:32195;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:32251;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="28"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 28</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:32288;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:32341;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the epoll object, our file descriptors from the created connections, and also say,</font></font></nobr></div>
<div style="position:absolute;top:32363;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">what events we subscribe to from these file descriptors. </font><font style="vertical-align: inherit;">In this case it is</font></font></nobr></div>
<div style="position:absolute;top:32384;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reading from sockets and writing to a socket (select.EPOLLIN | select.EPOLLOUT). </font><font style="vertical-align: inherit;">Further for</font></font></nobr></div>
<div style="position:absolute;top:32406;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">organizing the event polling cycle, we need to remember our objects and map</font></font></nobr></div>
<div style="position:absolute;top:32428;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">them by file descriptors. </font><font style="vertical-align: inherit;">That is, we form the conn_map dictionary, write to it -</font></font></nobr></div>
<div style="position:absolute;top:32449;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's get file descriptors and objects of our connections:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:32490;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Non-blocking I / O tutorial example</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:32534;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">socket</font></font></font></nobr></div>
<div style="position:absolute;top:32555;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:32599;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock = socket.socket ()</font></font></nobr></div>
<div style="position:absolute;top:32620;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.bind (( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">""</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001))</font></font></nobr></div>
<div style="position:absolute;top:32642;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sock.listen ()</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:32685;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># how to handle requests for conn1 and conn2</font></font></nobr></div>
<div style="position:absolute;top:32707;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># simultaneously without threads?</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:32729;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn1, addr = sock.accept ()</font></font></nobr></div>
<div style="position:absolute;top:32750;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn2, addr = sock.accept ()</font></font></nobr></div>
<div style="position:absolute;top:32794;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn1.setblocking (0)</font></font></nobr></div>
<div style="position:absolute;top:32815;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn2.setblocking (0)</font></font></nobr></div>
<div style="position:absolute;top:32859;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">epoll = select.epoll ()</font></font></nobr></div>
<div style="position:absolute;top:32880;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">epoll.register (conn1.fileno (), select.EPOLLIN | select.EPOLLOUT)</font></font></nobr></div>
<div style="position:absolute;top:32902;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">epoll.register (conn2.fileno (), select.EPOLLIN | select.EPOLLOUT)</font></font></nobr></div>
<div style="position:absolute;top:32945;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn_map = {</font></font></nobr></div>
<div style="position:absolute;top:32967;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn1.fileno (): conn1,</font></font></nobr></div>
<div style="position:absolute;top:32989;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn2.fileno (): conn2</font></font></nobr></div>
<div style="position:absolute;top:33010;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:33055;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a look at the event loop for our epoll, which is sometimes called</font></font></nobr></div>
<div style="position:absolute;top:33076;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emit event loop. </font><font style="vertical-align: inherit;">So, we are constantly polling our epoll object in an endless loop.</font></font></nobr></div>
<div style="position:absolute;top:33098;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a system call that returns a list of events to us, and these events contain</font></font></nobr></div>
<div style="position:absolute;top:33120;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the file descriptor and the actual event that occurred with this file</font></font></nobr></div>
<div style="position:absolute;top:33141;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a new descriptor. </font><font style="vertical-align: inherit;">After epoll has returned this list, we must check if</font></font></nobr></div>
<div style="position:absolute;top:33163;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">what kind of event came, from our dictionary, get the desired object to work with it and</font></font></nobr></div>
<div style="position:absolute;top:33185;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perform certain operations. </font><font style="vertical-align: inherit;">In this case, for example, we read data from</font></font></nobr></div>
<div style="position:absolute;top:33206;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this socket and print them to the console. </font><font style="vertical-align: inherit;">If an event has come that tells us that</font></font></nobr></div>
<div style="position:absolute;top:33228;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ket is ready to receive data from us, we must write data to this socket:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:33383;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:33439;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="29"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 29</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:33476;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:33529;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Non-blocking I / O tutorial example</font></font></nobr></div>
<div style="position:absolute;top:33551;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Event loop in epoll</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:33594;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:33616;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">events = epoll.poll (1)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:33659;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fileno, event</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">events:</font></font></font></nobr></div>
<div style="position:absolute;top:33681;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">event &amp; select.EPOLLIN:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:33702;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># handling reading from a socket</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:33724;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = conn_map [fileno] .recv (1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:33746;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(data.decode ( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">))</font></font></font></nobr></div>
<div style="position:absolute;top:33767;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elif </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">event &amp; select.EPOLLOUT:</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:33789;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># processing writing to a socket</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:33811;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conn_map [fileno] .send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"pong"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .encode ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"utf8"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ))</font></font></nobr></div>
<div style="position:absolute;top:33855;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such code is sometimes referred to as asynchronous programming, or multiplexing.</font></font></nobr></div>
<div style="position:absolute;top:33876;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input / output. </font><font style="vertical-align: inherit;">The code no longer looks too simple (although there is no creation in it</font></font></nobr></div>
<div style="position:absolute;top:33898;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threads or processes, no processing of closing sockets, no processing of new ones</font></font></nobr></div>
<div style="position:absolute;top:33920;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incoming connections). </font><font style="vertical-align: inherit;">Also, we do not waste memory on creating processes, there are no costs</font></font></nobr></div>
<div style="position:absolute;top:33941;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to create threads and synchronize them, no problem with the GIL.</font></font></nobr></div>
<div style="position:absolute;top:33985;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But if the code solves real problems, then the number of if statements will increase or</font></font></nobr></div>
<div style="position:absolute;top:34006;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callbacks. </font><font style="vertical-align: inherit;">In addition, we will have to change the code if the request processing appears</font></font></nobr></div>
<div style="position:absolute;top:34028;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calls to third-party libraries. </font><font style="vertical-align: inherit;">There is a solution for this: hide calls to select.epoll</font></font></nobr></div>
<div style="position:absolute;top:34050;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in a library function.</font></font></nobr></div>
<div style="position:absolute;top:34093;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is what Python frameworks did and wrote. </font><font style="vertical-align: inherit;">Most popular</font></font></nobr></div>
<div style="position:absolute;top:34115;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">there has been a Twisted framework for a long time, its work is very similar to our example, but the code on</font></font></nobr></div>
<div style="position:absolute;top:34136;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twisted, then Gevent and Tornado. </font><font style="vertical-align: inherit;">After Tornado, Python3 came with the asyncio framework, and</font></font></nobr></div>
<div style="position:absolute;top:34158;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">he is now mainstream. </font><font style="vertical-align: inherit;">In principle, it is based on the same thing as in</font></font></nobr></div>
<div style="position:absolute;top:34180;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tornado, but nonetheless asyncio comes with Python3 Core and is also based on</font></font></nobr></div>
<div style="position:absolute;top:34201;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operation of generators. </font><font style="vertical-align: inherit;">It is supported by official communities, and therefore all of our</font></font></nobr></div>
<div style="position:absolute;top:34223;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">further conversations about programming in one thread will be tied to the framework</font></font></nobr></div>
<div style="position:absolute;top:34245;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:34299;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.2. </font><font style="vertical-align: inherit;">Iterators and generators, what's the difference</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:34337;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To better understand how asyncio works, you first need to understand how it works.</font></font></nobr></div>
<div style="position:absolute;top:34359;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are generators and iterators, what are their similarities and differences.</font></font></nobr></div>
<div style="position:absolute;top:34402;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take an example with an iterator that generates a sequence of 0,</font></font></nobr></div>
<div style="position:absolute;top:34424;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1, 2. To solve this problem, you need to create a class and redefine its methods</font></font></nobr></div>
<div style="position:absolute;top:34446;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init__, __iter__ and __next__. </font><font style="vertical-align: inherit;">If we call the iterator in the for loop, then first you-</font></font></nobr></div>
<div style="position:absolute;top:34467;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the __iter__ method is called, and then the __next__ method will be called sequentially.</font></font></nobr></div>
<div style="position:absolute;top:34489;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the condition if self.current&gt; = self.top is met, an exception will be thrown, and</font></font></nobr></div>
<div style="position:absolute;top:34511;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the iterator will terminate:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:34571;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">29</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:34627;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="30"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 30</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:34664;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:34736;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Iterators</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:34779;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font></font><font color="#2b91b0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyRangeIterator </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
<div style="position:absolute;top:34801;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__init __ (self, top):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:34823;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.top = top</font></font></nobr></div>
<div style="position:absolute;top:34844;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.current = 0</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:34888;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__iter __ (self):</font></font></font></nobr></div>
<div style="position:absolute;top:34909;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self</font></font></font></nobr></div>
<div style="position:absolute;top:34953;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__next __ (self):</font></font></font></nobr></div>
<div style="position:absolute;top:34974;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.current&gt; = self.top:</font></font></font></nobr></div>
<div style="position:absolute;top:34996;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raise </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StopIteration</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35039;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current = self.current</font></font></nobr></div>
<div style="position:absolute;top:35061;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.current + = 1</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:35083;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35126;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">counter = MyRangeIterator (3)</font></font></nobr></div>
<div style="position:absolute;top:35148;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">counter</font></font></nobr></div>
<div style="position:absolute;top:35188;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;__ main __. MyRangeIterator object at 0xb671b5cc&gt;</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:35233;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">counter:</font></font></font></nobr></div>
<div style="position:absolute;top:35255;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(it)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35299;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></nobr></div>
<div style="position:absolute;top:35321;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></nobr></div>
<div style="position:absolute;top:35342;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
<div style="position:absolute;top:35383;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To create a generator, you need to write a regular function with the yield command. </font><font style="vertical-align: inherit;">Re-</font></font></nobr></div>
<div style="position:absolute;top:35405;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we lick the same functionality with the help of a generator. </font><font style="vertical-align: inherit;">In fact, when we call this</font></font></nobr></div>
<div style="position:absolute;top:35427;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function, an object will be created that can be iterated over:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:35467;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Generators</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:35510;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_range_generator (top):</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35532;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current = 0</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:35554;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current &lt;top:</font></font></font></nobr></div>
<div style="position:absolute;top:35575;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35597;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">current + = 1</font></font></nobr></div>
<div style="position:absolute;top:35640;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">counter = my_range_generator (3)</font></font></nobr></div>
<div style="position:absolute;top:35662;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">counter</font></font></nobr></div>
<div style="position:absolute;top:35703;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;generator object my_range_generator at 0xb67170ec&gt;</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:35759;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thirty</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:35815;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="31"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 31</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:35852;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:35905;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">counter:</font></font></font></nobr></div>
<div style="position:absolute;top:35926;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(it)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:35971;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></nobr></div>
<div style="position:absolute;top:35992;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></nobr></div>
<div style="position:absolute;top:36014;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
<div style="position:absolute;top:36055;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, when you call yield, the generator freezes its stack and all values</font></font></nobr></div>
<div style="position:absolute;top:36077;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local variables in the counter object. </font><font style="vertical-align: inherit;">When you call the functions again, the stack and lo-</font></font></nobr></div>
<div style="position:absolute;top:36098;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the local variables are restored, and we continue to execute the following in-</font></font></nobr></div>
<div style="position:absolute;top:36120;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure.</font></font></nobr></div>
<div style="position:absolute;top:36163;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summing up, let's say that generators have great opportunities for writing</font></font></nobr></div>
<div style="position:absolute;top:36185;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sania concurrency code.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:36239;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.3. </font><font style="vertical-align: inherit;">Generators and coroutines</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:36278;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this section, we will get acquainted with coroutines (or coroutines) and find out what</font></font></nobr></div>
<div style="position:absolute;top:36299;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">differences and similarities between generators and coroutines in Python. </font><font style="vertical-align: inherit;">Suppose our</font></font></nobr></div>
<div style="position:absolute;top:36321;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the goal is to filter the input stream using the grep function. </font><font style="vertical-align: inherit;">In the grep function, we pass</font></font></nobr></div>
<div style="position:absolute;top:36343;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we pass the pattern string, then we must rewrite the lines in this function and output</font></font></nobr></div>
<div style="position:absolute;top:36364;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the screen only those of them in which the specified pattern is present. </font><font style="vertical-align: inherit;">Let's implement</font></font></nobr></div>
<div style="position:absolute;top:36386;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this function as a coroutine.</font></font></nobr></div>
<div style="position:absolute;top:36429;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In an infinite loop, we call such a construction line to assign yield (in different</font></font></nobr></div>
<div style="position:absolute;top:36451;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the generators in the coroutines, we assign the result of the construct to a variable</font></font></nobr></div>
<div style="position:absolute;top:36473;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield). </font><font style="vertical-align: inherit;">In this case, the function will freeze its state and wait for input</font></font></nobr></div>
<div style="position:absolute;top:36494;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data using the send method. </font><font style="vertical-align: inherit;">So, if we call grep function, it will create</font></font></nobr></div>
<div style="position:absolute;top:36516;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coroutine. </font><font style="vertical-align: inherit;">In order to run our coroutine, we need to call the next method. </font><font style="vertical-align: inherit;">By-</font></font></nobr></div>
<div style="position:absolute;top:36538;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after the next method is called, the code of our function will run, the line will be displayed.</font></font></nobr></div>
<div style="position:absolute;top:36559;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">like start grep, an infinite loop will start, the code will go to the yield statement, and here</font></font></nobr></div>
<div style="position:absolute;top:36581;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">control will return to the main thread. </font><font style="vertical-align: inherit;">After that, in the main stream, we send</font></font></nobr></div>
<div style="position:absolute;top:36603;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data to our coroutine, and the function code is executed further:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:36643;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Coroutines (coroutines)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:36687;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep (pattern):</font></font></font></nobr></div>
<div style="position:absolute;top:36708;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"start grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:36730;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:36752;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line = </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:36773;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line:</font></font></font></nobr></div>
<div style="position:absolute;top:36795;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(line)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:36838;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:36860;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next (g) </font></font><font color="#008000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># g.send (None)</font></font></font></nobr></div>
<div style="position:absolute;top:36904;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start grep</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:36947;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:37003;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="32"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 32</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:37040;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:37093;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"golang is better?"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:37114;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python is simple!"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:37159;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python is simple!</font></font></nobr></div>
<div style="position:absolute;top:37200;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, we can conclude that generators produce values, and coroutines</font></font></nobr></div>
<div style="position:absolute;top:37221;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we consume them using the same yield method.</font></font></nobr></div>
<div style="position:absolute;top:37265;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sometimes it is necessary to stop a running coroutine. </font><font style="vertical-align: inherit;">This is done by calling</font></font></nobr></div>
<div style="position:absolute;top:37286;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the close method for the coroutine object. </font><font style="vertical-align: inherit;">The close method will be called automatically collection-</font></font></nobr></div>
<div style="position:absolute;top:37308;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garbage box, but if we need to stop the coroutine ourselves, we can call</font></font></nobr></div>
<div style="position:absolute;top:37330;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">close method. </font><font style="vertical-align: inherit;">The close method will throw a generator exception where the function</font></font></nobr></div>
<div style="position:absolute;top:37351;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">froze its meaning. </font><font style="vertical-align: inherit;">This exception cannot be ignored, it must be handled-</font></font></nobr></div>
<div style="position:absolute;top:37373;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use - for example, using a try except block:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:37414;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Coroutines, calling the close () method</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:37457;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep (pattern):</font></font></font></nobr></div>
<div style="position:absolute;top:37479;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"start grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:37500;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
<div style="position:absolute;top:37522;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:37544;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line = </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:37565;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line:</font></font></font></nobr></div>
<div style="position:absolute;top:37587;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(line)</font></font></font></nobr></div>
<div style="position:absolute;top:37609;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">except </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeneratorExit:</font></font></font></nobr></div>
<div style="position:absolute;top:37630;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"stop grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:37674;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:37695;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next (g) </font></font><font color="#008000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># g.send (None)</font></font></font></nobr></div>
<div style="position:absolute;top:37740;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start grep</font></font></nobr></div>
<div style="position:absolute;top:37784;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python is the best!"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:37829;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python is the best!</font></font></nobr></div>
<div style="position:absolute;top:37873;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.close ()</font></font></nobr></div>
<div style="position:absolute;top:37918;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stop grep</font></font></nobr></div>
<div style="position:absolute;top:37958;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sometimes it is necessary to pass exceptions to the coroutine itself. </font><font style="vertical-align: inherit;">This is done with</font></font></nobr></div>
<div style="position:absolute;top:37980;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calling the throw method. </font><font style="vertical-align: inherit;">An example is exactly the same:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:38135;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:38191;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="33"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 33</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:38228;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:38281;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Coroutines, throwing exceptions</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:38324;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep (pattern):</font></font></font></nobr></div>
<div style="position:absolute;top:38346;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"start grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:38367;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
<div style="position:absolute;top:38389;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:38411;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line = </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:38432;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line:</font></font></font></nobr></div>
<div style="position:absolute;top:38454;left:262"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(line)</font></font></font></nobr></div>
<div style="position:absolute;top:38476;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">except </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeneratorExit:</font></font></font></nobr></div>
<div style="position:absolute;top:38497;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"stop grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:38541;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:38562;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next (g) </font></font><font color="#008000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># g.send (None)</font></font></font></nobr></div>
<div style="position:absolute;top:38584;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python is the best!"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:38606;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.throw (RuntimeError, </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"something wrong"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:38650;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traceback (most recent call last):</font></font></nobr></div>
<div style="position:absolute;top:38671;left:107"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File "&lt;stdin&gt;", line 1, in &lt;module&gt;</font></font></nobr></div>
<div style="position:absolute;top:38693;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RuntimeError: something wrong</font></font></nobr></div>
<div style="position:absolute;top:38733;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see an even more complex example. </font><font style="vertical-align: inherit;">We have a grep coroutine containing</font></font></nobr></div>
<div style="position:absolute;top:38755;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inside a yield statement, and we want to call the grep coroutine in another coroutine.</font></font></nobr></div>
<div style="position:absolute;top:38776;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to do it? </font><font style="vertical-align: inherit;">If we write the code that is shown on the slide, and then we do</font></font></nobr></div>
<div style="position:absolute;top:38798;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">given call, then will the g variable be a coroutine? </font><font style="vertical-align: inherit;">Since it does not contain</font></font></nobr></div>
<div style="position:absolute;top:38820;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield statement, it will be executed immediately, because </font><font style="vertical-align: inherit;">will be a normal function:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:38882;left:104"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Calls to coroutines, PEP 380</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:38926;left:104"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep (pattern):</font></font></font></nobr></div>
<div style="position:absolute;top:38947;left:148"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"start grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:38969;left:148"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:38991;left:191"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line = </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:39012;left:191"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line:</font></font></font></nobr></div>
<div style="position:absolute;top:39034;left:234"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(line)</font></font></font></nobr></div>
<div style="position:absolute;top:39077;left:104"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep_python_coroutine ():</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:39099;left:148"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:39121;left:148"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next (g)</font></font></nobr></div>
<div style="position:absolute;top:39142;left:148"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python is the best!"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:39164;left:148"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.close ()</font></font></nobr></div>
<div style="position:absolute;top:39207;left:104"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep_python_coroutine () </font></font><font color="#008000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># is g coroutine?</font></font></font></nobr></div>
<div style="position:absolute;top:39260;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start grep</font></font></nobr></div>
<div style="position:absolute;top:39281;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python is the best!</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:39323;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:39379;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="34"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 34</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:39416;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:39469;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to make it convenient to call others from some coroutines, in Python we have developed</font></font></nobr></div>
<div style="position:absolute;top:39491;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whether the PEP 0380 standard and implemented in Python 3. </font><font style="vertical-align: inherit;">The new standard has introduced information</font></font></nobr></div>
<div style="position:absolute;top:39512;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure yield from. </font><font style="vertical-align: inherit;">Using it, you can delegate a call to one</font></font></nobr></div>
<div style="position:absolute;top:39534;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coroutines in another. </font><font style="vertical-align: inherit;">Our example can be rewritten as follows we use</font></font></nobr></div>
<div style="position:absolute;top:39556;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the yield from statement and specify the object as another coroutine:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:39597;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Coroutines, yield from PEP 0380</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:39640;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep (pattern):</font></font></font></nobr></div>
<div style="position:absolute;top:39662;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"start grep" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:39683;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:39705;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line = </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:39727;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line:</font></font></font></nobr></div>
<div style="position:absolute;top:39748;left:219"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(line)</font></font></font></nobr></div>
<div style="position:absolute;top:39792;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep_python_coroutine ():</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:39813;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:39835;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:39878;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g = grep_python_coroutine () </font></font><font color="#008000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># is g coroutine?</font></font></font></nobr></div>
<div style="position:absolute;top:39900;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></nobr></div>
<div style="position:absolute;top:39944;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;generator object grep_python_coroutine at 0x7f027eec03b8&gt;</font></font></nobr></div>
<div style="position:absolute;top:39989;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send (None)</font></font></nobr></div>
<div style="position:absolute;top:40033;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start grep</font></font></nobr></div>
<div style="position:absolute;top:40078;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g.send ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"python wow!"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:40122;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python wow!</font></font></nobr></div>
<div style="position:absolute;top:40163;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, if we try to call our grep_python_coroutine function, it</font></font></nobr></div>
<div style="position:absolute;top:40184;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be a coroutine or generator, and in order to continue and execute</font></font></nobr></div>
<div style="position:absolute;top:40206;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the code that is inside it, you need to call the send method, pass it there</font></font></nobr></div>
<div style="position:absolute;top:40228;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">value None and then call the send method and pass the required line. </font><font style="vertical-align: inherit;">In this way,</font></font></nobr></div>
<div style="position:absolute;top:40249;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Python 3, it has become very easy and convenient to call another from one coroutine.</font></font></nobr></div>
<div style="position:absolute;top:40293;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For regular generators, the yield from statement can be used as a replacement</font></font></nobr></div>
<div style="position:absolute;top:40314;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a for loop within which the yield statement is called. </font><font style="vertical-align: inherit;">Let's look at an example. </font><font style="vertical-align: inherit;">For example</font></font></nobr></div>
<div style="position:absolute;top:40336;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">measures, we have two objects that can be iterated over - a and b. </font><font style="vertical-align: inherit;">Further</font></font></nobr></div>
<div style="position:absolute;top:40358;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the loop, call the chain function, pass these lists there and display what we are generating</font></font></nobr></div>
<div style="position:absolute;top:40379;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our function chain. </font><font style="vertical-align: inherit;">In the chain function we use the yield from construct</font></font></nobr></div>
<div style="position:absolute;top:40401;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and pass there an object that can be iterated over. </font><font style="vertical-align: inherit;">The_same_chain function is</font></font></nobr></div>
<div style="position:absolute;top:40423;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">works the same way, but implemented using loops:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:40511;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">34</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:40567;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="35"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 35</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:40604;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:40657;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># PEP 380, generators</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:40700;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chain (x_iterable, y_iterable):</font></font></font></nobr></div>
<div style="position:absolute;top:40722;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x_iterable</font></font></font></nobr></div>
<div style="position:absolute;top:40743;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y_iterable</font></font></font></nobr></div>
<div style="position:absolute;top:40787;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the_same_chain (x_iterable, y_iterable):</font></font></font></nobr></div>
<div style="position:absolute;top:40808;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x_iterable:</font></font></font></nobr></div>
<div style="position:absolute;top:40830;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></font></nobr></div>
<div style="position:absolute;top:40873;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y_iterable:</font></font></font></nobr></div>
<div style="position:absolute;top:40895;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:40938;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a = [1, 2, 3]</font></font></nobr></div>
<div style="position:absolute;top:40960;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b = (4, 5)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:40982;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chain (a, b):</font></font></font></nobr></div>
<div style="position:absolute;top:41003;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(x)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:41048;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></nobr></div>
<div style="position:absolute;top:41069;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></nobr></div>
<div style="position:absolute;top:41091;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></nobr></div>
<div style="position:absolute;top:41113;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">four</font></font></nobr></div>
<div style="position:absolute;top:41134;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">five</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:41189;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.4. </font><font style="vertical-align: inherit;">First steps with asyncio</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:41227;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio is a library that became part of Python 3. It is responsible for non-blocking</font></font></nobr></div>
<div style="position:absolute;top:41249;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I / O, on this framework you can write a service that works with</font></font></nobr></div>
<div style="position:absolute;top:41270;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tens of thousands of connections simultaneously. </font><font style="vertical-align: inherit;">This framework is based on</font></font></nobr></div>
<div style="position:absolute;top:41292;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generators and coroutines, which we have already talked about in the previous videos.</font></font></nobr></div>
<div style="position:absolute;top:41335;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following example, we declare a function and add a decorator to this function</font></font></nobr></div>
<div style="position:absolute;top:41357;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio.coroutine, thus making our function a coroutine. </font><font style="vertical-align: inherit;">Further, we are in infinity</font></font></nobr></div>
<div style="position:absolute;top:41379;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this loop, we output the "Hello World" line to the console and call yield</font></font></nobr></div>
<div style="position:absolute;top:41401;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from asyncio.sleep (1.0), that is, we "fall asleep" for one second. </font><font style="vertical-align: inherit;">Note,</font></font></nobr></div>
<div style="position:absolute;top:41422;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that we do not use the usual time.sleep call, but a special construction</font></font></nobr></div>
<div style="position:absolute;top:41444;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield from in order for our coroutine to suspend its work, thereby yes-</font></font></nobr></div>
<div style="position:absolute;top:41465;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">giving the opportunity to execute other coroutines:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:41699;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:41755;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="36"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 36</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:41792;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:41845;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># asyncio, Hello World</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:41888;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:41931;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ asyncio.coroutine</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:41953;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hello_world ():</font></font></font></nobr></div>
<div style="position:absolute;top:41975;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
<div style="position:absolute;top:41996;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Hello World!" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
<div style="position:absolute;top:42018;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yield from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio.sleep (1.0)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:42062;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All code in asyncio is built around the notion of an event loop, or how else</font></font></nobr></div>
<div style="position:absolute;top:42084;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is sometimes called the event loop. </font><font style="vertical-align: inherit;">event loop is a kind of task scheduler, or</font></font></nobr></div>
<div style="position:absolute;top:42105;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coroutines that are executed in it. </font><font style="vertical-align: inherit;">It is responsible for I / O, signal control-</font></font></nobr></div>
<div style="position:absolute;top:42127;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mi, all network operations and switches the context between all coroutines that</font></font></nobr></div>
<div style="position:absolute;top:42149;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rye in it are registered and executed. </font><font style="vertical-align: inherit;">If one coroutine is awaiting completion</font></font></nobr></div>
<div style="position:absolute;top:42170;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some network operation, then at this moment the event loop can switch to another</font></font></nobr></div>
<div style="position:absolute;top:42192;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">go to the coroutine and continue its execution. </font><font style="vertical-align: inherit;">Let's continue our example. </font><font style="vertical-align: inherit;">By calling</font></font></nobr></div>
<div style="position:absolute;top:42214;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio.get_event_loop we get the event loop. </font><font style="vertical-align: inherit;">It is an object that</font></font></nobr></div>
<div style="position:absolute;top:42235;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">executes coroutines (ordinary functions cannot be executed with it, you need to use</font></font></nobr></div>
<div style="position:absolute;top:42257;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call coroutines):</font></font></nobr></div>
<div style="position:absolute;top:42298;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:42319;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (hello_world ())</font></font></nobr></div>
<div style="position:absolute;top:42364;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello World!</font></font></nobr></div>
<div style="position:absolute;top:42385;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello World!</font></font></nobr></div>
<div style="position:absolute;top:42407;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b></nobr></div>
<div style="position:absolute;top:42448;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to finish working with the event loop, you need to call</font></font></nobr></div>
<div style="position:absolute;top:42469;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the close method for our loop object:</font></font></nobr></div>
<div style="position:absolute;top:42513;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.close ()</font></font></nobr></div>
<div style="position:absolute;top:42556;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As of Python 3.5, there is a new PEP 492 that introduces a special</font></font></nobr></div>
<div style="position:absolute;top:42577;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The normal syntax for writing coroutines is with async def and await instructions. </font><font style="vertical-align: inherit;">This</font></font></nobr></div>
<div style="position:absolute;top:42599;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the syntax looks more concise and beautiful compared to the previous one, except</font></font></nobr></div>
<div style="position:absolute;top:42621;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">th, declaring a function through the async def construct guarantees us that this function</font></font></nobr></div>
<div style="position:absolute;top:42642;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a coroutine. </font><font style="vertical-align: inherit;">If we use this syntax, then internally we cannot use</font></font></nobr></div>
<div style="position:absolute;top:42664;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to call the yield from construct, we must use the await call:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:42887;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:42943;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="37"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 37</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:42980;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:43033;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># asyncio, async def / await; </font><font style="vertical-align: inherit;">PEP 492 Python3.5</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:43076;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43119;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hello_world ():</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:43141;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">True:</font></font></font></nobr></div>
<div style="position:absolute;top:43163;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Hello World!" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43184;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">await asyncio.sleep (1.0)</font></font></nobr></div>
<div style="position:absolute;top:43228;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:43249;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (hello_world ())</font></font></nobr></div>
<div style="position:absolute;top:43271;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.close ()</font></font></nobr></div>
<div style="position:absolute;top:43315;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at a more complex example and write our own TCP server that</font></font></nobr></div>
<div style="position:absolute;top:43337;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handles multiple incoming connections at the same time. </font><font style="vertical-align: inherit;">So we get our</font></font></nobr></div>
<div style="position:absolute;top:43358;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">event loop, make a call to start_server, pass the coroutine to this call. </font><font style="vertical-align: inherit;">In function</font></font></nobr></div>
<div style="position:absolute;top:43380;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start_server, we must also pass parameters in the form of a host and port on which we</font></font></nobr></div>
<div style="position:absolute;top:43402;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will listen to the connection. </font><font style="vertical-align: inherit;">Next, we start the installation of this connection and do</font></font></nobr></div>
<div style="position:absolute;top:43423;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call loop.run_forever. </font><font style="vertical-align: inherit;">Thus, we will process all incoming connections.</font></font></nobr></div>
<div style="position:absolute;top:43445;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and after we have accepted a connection, for each connection a</font></font></nobr></div>
<div style="position:absolute;top:43467;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a separate coroutine, and our function will be executed in this coroutine. </font><font style="vertical-align: inherit;">With the help of con-</font></font></nobr></div>
<div style="position:absolute;top:43488;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure await reader we can read data from our socket, and there is also</font></font></nobr></div>
<div style="position:absolute;top:43510;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writer (if we need to, we can write data to our socket):</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:43551;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># asyncio, tcp server</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:43594;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43637;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> handle_echo (reader, writer):</font></font></nobr></div>
<div style="position:absolute;top:43659;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data = await reader.read (1024)</font></font></nobr></div>
<div style="position:absolute;top:43681;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message = data.decode ()</font></font></nobr></div>
<div style="position:absolute;top:43702;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addr = writer.get_extra_info ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"peername"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:43724;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"received% r from% r" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% (message, addr))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43746;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writer.close ()</font></font></nobr></div>
<div style="position:absolute;top:43789;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:43811;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coro = asyncio.start_server (handle_echo, </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 10001,</font></font></nobr></div>
<div style="position:absolute;top:43832;left:391"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = loop)</font></font></nobr></div>
<div style="position:absolute;top:43854;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server = loop.run_until_complete (coro)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:43876;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">try </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43897;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_forever ()</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:43919;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">except </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KeyboardInterrupt:</font></font></font></nobr></div>
<div style="position:absolute;top:43941;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pass</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:43984;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.close ()</font></font></nobr></div>
<div style="position:absolute;top:44006;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (server.wait_closed ())</font></font></nobr></div>
<div style="position:absolute;top:44027;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.close ()</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:44075;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:44131;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="38"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 38</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:44168;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:44221;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a look at the client code, which can also be asynchronous. </font><font style="vertical-align: inherit;">Let's say</font></font></nobr></div>
<div style="position:absolute;top:44243;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we the client will transmit the line. </font><font style="vertical-align: inherit;">We pass this line to the tcp_echo_client coroutine</font></font></nobr></div>
<div style="position:absolute;top:44264;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(message) and our event loop. </font><font style="vertical-align: inherit;">Further, in order to create a connection, we must</font></font></nobr></div>
<div style="position:absolute;top:44286;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call the asyncio.open_connection method. </font><font style="vertical-align: inherit;">In this call, we must send an address</font></font></nobr></div>
<div style="position:absolute;top:44308;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pair and await call will return us reader and writer. </font><font style="vertical-align: inherit;">These are two objects with the help of which</font></font></nobr></div>
<div style="position:absolute;top:44329;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you can interact with our remote server. </font><font style="vertical-align: inherit;">That is, using the object</font></font></nobr></div>
<div style="position:absolute;top:44351;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reader you can read data from the server, with the writer object you can write</font></font></nobr></div>
<div style="position:absolute;top:44373;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data to the server:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:44413;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># asyncio, tcp client</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:44457;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:44500;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tcp_echo_client (message, loop):</font></font></nobr></div>
<div style="position:absolute;top:44522;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reader, writer = await asyncio.open_connection ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"127.0.0.1"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></nobr></div>
<div style="position:absolute;top:44543;left:638"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10001, loop = loop)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:44587;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"send:% r" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% message)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:44608;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writer.write (message.encode ())</font></font></nobr></div>
<div style="position:absolute;top:44630;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writer.close ()</font></font></nobr></div>
<div style="position:absolute;top:44673;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:44695;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message = </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hello World!"</font></font></font></nobr></div>
<div style="position:absolute;top:44717;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (tcp_echo_client (message, loop))</font></font></nobr></div>
<div style="position:absolute;top:44738;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.close ()</font></font></nobr></div>
<div style="position:absolute;top:44782;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can easily create multiple such asynchronous clients and at the same time you-</font></font></nobr></div>
<div style="position:absolute;top:44804;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fulfill requests to different servers without doing any threads or processes.</font></font></nobr></div>
<div style="position:absolute;top:44825;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is very convenient, simple, and the code is quite productive.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:44880;left:85"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.5. </font><font style="vertical-align: inherit;">Working with asyncio</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:44918;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this last section, we will discuss what asyncio.Future is and talk about</font></font></nobr></div>
<div style="position:absolute;top:44940;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how to create objects of type asyncio.Task. </font><font style="vertical-align: inherit;">We will also consider the problem of running syn-</font></font></nobr></div>
<div style="position:absolute;top:44961;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chrono functions in the event loop and discuss a little the libraries that</font></font></nobr></div>
<div style="position:absolute;top:44983;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are available for working with the asyncio framework.</font></font></nobr></div>
<div style="position:absolute;top:45026;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's move on to an example. </font><font style="vertical-align: inherit;">In it we declare the slow_operation coroutine, in it</font></font></nobr></div>
<div style="position:absolute;top:45048;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we pass a certain object asyncio.Future (), which is executed, and its execution still</font></font></nobr></div>
<div style="position:absolute;top:45070;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not completed. </font><font style="vertical-align: inherit;">The interface of this object is entirely consistent with the interface</font></font></nobr></div>
<div style="position:absolute;top:45092;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concurrent.futures.Future (we looked at it when we got acquainted with streams).</font></font></nobr></div>
<div style="position:absolute;top:45135;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the coroutine, we sleep for one second, and after that using set_result</font></font></nobr></div>
<div style="position:absolute;top:45156;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">put the result into our future object:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:45263;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:45319;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="39"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 39</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:45356;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:45409;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">### asyncio.Future, analogous to concurrent.futures.Future</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:45452;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:45495;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> slow_operation (future):</font></font></nobr></div>
<div style="position:absolute;top:45517;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">await asyncio.sleep (1)</font></font></nobr></div>
<div style="position:absolute;top:45539;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">future.set_result ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Future is done!"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:45582;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:45604;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">future = asyncio.Future ()</font></font></nobr></div>
<div style="position:absolute;top:45625;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio.ensure_future (slow_operation (future))</font></font></nobr></div>
<div style="position:absolute;top:45669;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (future)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:45690;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(future.result ())</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:45712;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.close ()</font></font></nobr></div>
<div style="position:absolute;top:45756;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Future is done!</font></font></nobr></div>
<div style="position:absolute;top:45797;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please note - in the main program we create a future object, then we</font></font></nobr></div>
<div style="position:absolute;top:45819;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we create our coroutine using ensure_future, and in the main processing loop with</font></font></nobr></div>
<div style="position:absolute;top:45841;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">events, we are waiting for the future to complete (not the slow_operation function!). </font><font style="vertical-align: inherit;">So</font></font></nobr></div>
<div style="position:absolute;top:45862;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, with the help of objects of the class future, you can build chains not only from</font></font></nobr></div>
<div style="position:absolute;top:45884;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two objects, but also more complex chains, and it is very convenient to wait for the completion of the</font></font></nobr></div>
<div style="position:absolute;top:45906;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filling all objects.</font></font></nobr></div>
<div style="position:absolute;top:45949;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see how you can run multiple coroutines in one event loop. </font><font style="vertical-align: inherit;">For</font></font></nobr></div>
<div style="position:absolute;top:45971;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this, as a rule, an object of type asyncio.Task is used, which is inherited</font></font></nobr></div>
<div style="position:absolute;top:45992;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the nickname of the asyncio.Future class with a number of additional methods. </font><font style="vertical-align: inherit;">So, directly the object</font></font></nobr></div>
<div style="position:absolute;top:46014;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type asyncio.Task you do not need to create, you should use the create_task method and re-</font></font></nobr></div>
<div style="position:absolute;top:46036;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">give a coroutine to it (each object of the Task type has its own coroutine, which</font></font></nobr></div>
<div style="position:absolute;top:46057;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">he performs). </font><font style="vertical-align: inherit;">So, we create a list of two tasks. </font><font style="vertical-align: inherit;">We remember it as a list</font></font></nobr></div>
<div style="position:absolute;top:46079;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objects, and then using the asyncio.wait method we execute the list of our tas-</font></font></nobr></div>
<div style="position:absolute;top:46101;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kov in the event loop:</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:46451;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:46507;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="40"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 40</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:46544;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:46597;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">### asyncio.Task, running multiple coroutines</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:46640;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:46683;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sleep_task (num):</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:46705;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">range (5):</font></font></font></nobr></div>
<div style="position:absolute;top:46727;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(f </font></font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"process task: {num} iter: {i}" </font></font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:46748;left:176"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">await asyncio.sleep (1)</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:46792;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:46835;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># ensure_future or create_task</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:46857;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:46900;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">task_list = [loop.create_task (sleep_task (i)) </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> i </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> range (2)]</font></font></nobr></div>
<div style="position:absolute;top:46922;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (asyncio.wait (task_list))</font></font></nobr></div>
<div style="position:absolute;top:46965;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.close ()</font></font></nobr></div>
<div style="position:absolute;top:47009;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 0 iter: 0</font></font></nobr></div>
<div style="position:absolute;top:47031;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 1 iter: 0</font></font></nobr></div>
<div style="position:absolute;top:47053;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 0 iter: 1</font></font></nobr></div>
<div style="position:absolute;top:47074;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 1 iter: 1</font></font></nobr></div>
<div style="position:absolute;top:47096;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 0 iter: 2</font></font></nobr></div>
<div style="position:absolute;top:47118;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 1 iter: 2</font></font></nobr></div>
<div style="position:absolute;top:47139;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 0 iter: 3</font></font></nobr></div>
<div style="position:absolute;top:47161;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 1 iter: 3</font></font></nobr></div>
<div style="position:absolute;top:47183;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 0 iter: 4</font></font></nobr></div>
<div style="position:absolute;top:47204;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process task: 1 iter: 4</font></font></nobr></div>
<div style="position:absolute;top:47245;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see that we first have one task performing zero iteration, then the second</font></font></nobr></div>
<div style="position:absolute;top:47267;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task numbered performs its zero iteration, and so on. </font><font style="vertical-align: inherit;">That is, coroutines are executed</font></font></nobr></div>
<div style="position:absolute;top:47289;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the event loop at the same time, and the code is sequential.</font></font></nobr></div>
<div style="position:absolute;top:47332;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can also perform multiple tasks using a convenient function</font></font></nobr></div>
<div style="position:absolute;top:47354;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio.gather, which allows you not to call the create_task method separately:</font></font></nobr></div>
<div style="position:absolute;top:47394;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (asyncio.gather (sleep_task (10),</font></font></nobr></div>
<div style="position:absolute;top:47416;left:509"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sleep_task (20)))</font></font></nobr></div>
<div style="position:absolute;top:47460;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But what if we need to execute a synchronous function in the event loop? </font><font style="vertical-align: inherit;">As a rule</font></font></nobr></div>
<div style="position:absolute;top:47482;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">well, such tasks should not arise, but if suddenly they did arise, then they will be</font></font></nobr></div>
<div style="position:absolute;top:47503;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pose a little difficulty out of yourself. </font><font style="vertical-align: inherit;">event loop constantly switches the context between</font></font></nobr></div>
<div style="position:absolute;top:47525;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do all our coroutines and executes them sequentially - while one coroutine</font></font></nobr></div>
<div style="position:absolute;top:47547;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">waits for I / O, the second coroutine of the event loop successfully executes. </font><font style="vertical-align: inherit;">If the code,</font></font></nobr></div>
<div style="position:absolute;top:47568;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which will be executed in the coroutine will be blocking, then the event loop will not be able to de-</font></font></nobr></div>
<div style="position:absolute;top:47590;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do context switching. </font><font style="vertical-align: inherit;">To solve this problem in asyncio there is a method</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:47639;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:47695;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="41"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page 41</font></font></b></a></font></td></tr></tbody></table></div><font size="3" face="Times"><span style="font-size:12px;font-family:Times">
<div style="position:absolute;top:47732;left:293"><nobr><font style="vertical-align: inherit;"><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;">Python Programming</font></a></font><font style="vertical-align: inherit;"> Course</font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"><font style="vertical-align: inherit;"></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://www.coursera.org/learn/programming-in-python/%3Futm_source%3Dpdf_doc"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Mail.Ru Group</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:47785;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run_in_executor. </font><font style="vertical-align: inherit;">It means to run the code literally in the thread pool which is inside</font></font></nobr></div>
<div style="position:absolute;top:47807;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this event loop will automatically be created (you can use your own pool of</font></font></nobr></div>
<div style="position:absolute;top:47828;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currents or already ready by default).</font></font></nobr></div>
<div style="position:absolute;top:47872;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example, you can observe how the urlopen function, which opens a certain</font></font></nobr></div>
<div style="position:absolute;top:47894;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The url that was passed to it downloads the results in a separate thread. </font><font style="vertical-align: inherit;">For this we call</font></font></nobr></div>
<div style="position:absolute;top:47915;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We create the run_in_executor method. </font><font style="vertical-align: inherit;">The required number of threads will be created inside it,</font></font></nobr></div>
<div style="position:absolute;top:47937;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and our sync_get_url function with url parameter will be executed in a separate thread</font></font></nobr></div>
<div style="position:absolute;top:47958;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke. </font><font style="vertical-align: inherit;">In order to wait for the result of the function execution in a separate thread, we</font></font></nobr></div>
<div style="position:absolute;top:47980;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use the await construct and pass the future there. </font><font style="vertical-align: inherit;">We will open</font></font></nobr></div>
<div style="position:absolute;top:48002;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">google.com page and display the number of bytes that it occupies:</font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:48042;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># loop.run_in_executor, run on a separate thread</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:48086;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></font></nobr></div>
<div style="position:absolute;top:48107;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">urllib.request</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> import </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">urlopen</font></font></font></nobr></div>
</span></font>
<font size="3" color="#008000" face="Times"><span style="font-size:15px;font-family:Times;color:#008000">
<div style="position:absolute;top:48151;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a synchronous function</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:48172;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sync_get_url (url):</font></font></font></nobr></div>
<div style="position:absolute;top:48194;left:122"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">urlopen (url) .read ()</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:48237;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async </font></font><font color="#0000ff"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> load_url (url, loop = None):</font></font></nobr></div>
<div style="position:absolute;top:48259;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">future = loop.run_in_executor (None, sync_get_url, url)</font></font></nobr></div>
<div style="position:absolute;top:48281;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = await future</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:48302;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print </font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(len (response))</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:15px;font-family:Times">
<div style="position:absolute;top:48346;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop = asyncio.get_event_loop ()</font></font></nobr></div>
<div style="position:absolute;top:48367;left:90"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loop.run_until_complete (load_url ( </font></font><font color="#a31414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"https://google.com"</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , loop = loop))</font></font></nobr></div>
<div style="position:absolute;top:48412;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11055</font></font></nobr></div>
<div style="position:absolute;top:48453;left:111"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a rule, such tasks will arise for you if some library does not have</font></font></nobr></div>
<div style="position:absolute;top:48474;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support for working with asyncio. </font><font style="vertical-align: inherit;">This can negatively affect performance,</font></font></nobr></div>
<div style="position:absolute;top:48496;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">because, as we recall, threads in Python start and run under a GIL constraint. </font><font style="vertical-align: inherit;">IN</font></font></nobr></div>
<div style="position:absolute;top:48518;left:85"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recently there are libraries with asyncio support - </font></font><font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs/aiohttp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aiohttp</font></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs/aiohttp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></a> <font color="#0000ff"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs/aiomysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aiomysql</font></font></a></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs/aiomysql"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></nobr></div>
</span></font>
<font size="3" color="#0000ff" face="Times"><span style="font-size:15px;font-family:Times;color:#0000ff">
<div style="position:absolute;top:48540;left:85"><nobr><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs/aiomcache"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aiomcache </font></font></a><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></font><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">many others</font></font></a><font color="#000000"><a href="https://translate.google.com/translate?hl=en&amp;prev=_t&amp;sl=auto&amp;tl=en&amp;u=https://github.com/aio-libs"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:19px;font-family:Times">
<div style="position:absolute;top:48827;left:809"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41</font></font></nobr></div>
</span></font>


<script>_addload(function(){_setupIW('com');_csi('ru','en','_0c1c1bede648463ed60e3bd2e67db919_W5.pdf');});</script>
            <script>
              function gtElInit() {
                var lib = new google.translate.TranslateService();
                lib.setCheckVisibility(false);
                lib.translatePage('ru', 'en', function (progress, done, error) {
                  if (progress == 100 || done || error) {
                    document.getElementById("gt-dt-spinner").style.display = "none";
                  }
                });
              }
            </script>
            <script src="./Table of contents_files/f.txt">
            </script><div id="goog-gt-tt" class="goog-tooltip skiptranslate" dir="rtl" style="visibility: hidden; left: 0px; top: 566px; display: none;"><div style="padding: 8px;"><div><div class="logo"><img src="./Table of contents_files/translate_24dp.png" width="20" height="20" alt="Google "></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray"> </h1></div><div class="middle" style="padding: 8px;"><div class="original-text">  ,        Python   -</div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">  </span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none; opacity: 0;"></div></div>
          <div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><span><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./Table of contents_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iws_w.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iws_e.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iws_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iws_nw" style="overflow: hidden;"></div><div class="SPRITE_iws_ne" style="overflow: hidden;"></div><div class="SPRITE_iws_sw" style="overflow: hidden;"></div><div class="SPRITE_iws_se" style="overflow: hidden;"></div><div class="SPRITE_iws_tap" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_l" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_u" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ul" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_rd" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ld" style="overflow: hidden;"></div><div class="SPRITE_iws_tab_dl" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_dr" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_l" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_r" style="overflow: hidden; display: none;"></div></div></span><div id="google-infowindow" class="notranslate"><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./Table of contents_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iw_w.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iw_e.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./Table of contents_files/iw_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iw_nw" style="overflow: hidden;"></div><div class="SPRITE_iw_ne" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_l" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_u" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ul" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_rd" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ld" style="overflow: hidden;"></div><div class="SPRITE_iw_sw0" style="overflow: hidden;"></div><div class="SPRITE_iw_se0" style="overflow: hidden;"></div><div class="SPRITE_close" style="overflow: hidden; z-index: 10000; cursor: pointer; visibility: visible;"></div><div class="SPRITE_maximize" style="overflow: hidden; z-index: 10000; visibility: hidden; cursor: pointer; display: none;"></div><div class="SPRITE_restore" style="overflow: hidden; z-index: 10001; visibility: hidden; cursor: pointer; display: none;"></div></div></div><div style="display: none;"><iframe sandbox="" id="google-feedback-frame" name="FEEDBACK_TARGET_IFRAME_NAME" src="./Table of contents_files/saved_resource.html"></iframe></div></body></html>